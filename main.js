(()=>{"use strict";const e=["carrier","battleship","cruiser","submarine","destroyer"],t=e=>Math.floor(Math.random()*e),r=(e=10)=>[t(e),t(e)],n=()=>{let t=Array(10).fill(null).map((()=>Array(10).fill(null))),n=[];const l=(e,t,r,n)=>{let l=t+r,i=e;return"vertical"===n&&(l=t,i=e+r),[i,l]},i=(e,r,i)=>{const a=e.getDirection(),c=((e,r,n,i)=>{const a=[];for(let c=0;c<e;c++){const[e,s]=l(n,i,c,r);if(!(e<10&&s<10))return!1;a.push(t[e][s])}return a.every((e=>null===e))})(e.length,a,r,i);if(c){for(let n=0;n<e.length;n++){const[c,s]=l(r,i,n,a);t[c][s]={ship:e,index:n}}return n.push(e),c}return c},a=e=>{const[t,n]=r();Math.random()>.5&&e.changeDirection(),i(e,t,n)||a(e)};return{getBoard:()=>t,areAllShipsPlaced:()=>n.length===e.length,placeShip:i,receiveAttack:(e,r)=>(null===t[e][r]?t[e][r]="miss":t[e][r].ship&&(t[e][r].ship.hit(t[e][r].index),t[e][r]="hit"),t[e][r]),areAllShipsSunk:()=>n.every((e=>e.isSunk())),reset:()=>{t=Array(10).fill(null).map((()=>Array(10).fill(null))),n=[]},autoPlaceFleet:e=>{for(const t in e)a(e[t])}}},l={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2},i=e=>{const t={};return e.forEach((e=>t[e]=(e=>{const t=e,r=l[e];let n="horizontal";const i=Array(r).fill(null);return{id:t,length:r,getDirection:()=>n,changeDirection:()=>{n="horizontal"===n?"vertical":"horizontal"},hit:e=>i[e]="hit",getHits:()=>i,isSunk:()=>i.every((e=>"hit"===e))}})(e))),t},a=t=>{let n=i(e);const l=e=>{const[t,n]=r(),i=e.getBoard()[t][n];"miss"===i||"hit"===i?l(e):e.receiveAttack(t,n)};return{getType:()=>t,getFleet:()=>n,attack:(e,t,r)=>r.receiveAttack(e,t),autoAttack:l,resetFleet:()=>n=i(e)}},c=document.querySelector(".winner-container"),s=document.querySelector(".winner-info"),o=document.querySelector(".buttons-container"),u=document.querySelector(".auto-place"),d=(()=>{const e=(e,t,r)=>`<div class="grid-cell cell-${e}-${t} ${r}" data-y='${e}' data-x='${t}'></div>`;return{renderGrid:(t,r,n)=>{(e=>{e.textContent=""})(t);const l=r.getBoard(),{length:i}=l;let a="";for(let t=0;t<i;t++)for(let r=0;r<i;r++){let i=l[t][r];null===i?i="":i.ship&&(i="human"===n?i.ship.id:""),a+=e(t,r,i)}t.insertAdjacentHTML("afterbegin",a)},renderWinner:e=>{c.classList.add("active"),s.textContent=e},startGame:()=>{o.classList.add("hide"),u.setAttribute("disabled","")}}})(),h=document.querySelector(".grid-p1"),p=document.querySelector(".grid-p2"),g=()=>{const e=a("human"),t=a("computer"),r=n(),l=n(),i=()=>{d.renderGrid(h,r,e.getType()),d.renderGrid(p,l,t.getType())},c=n=>{const a=n.target;if(a.classList.contains("grid-cell")){const{y:n}=a.dataset,{x:s}=a.dataset,o=l.getBoard()[n][s];if("miss"!==o&&"hit"!==o&&(e.attack(n,s,l),t.autoAttack(r),i()),r.areAllShipsSunk()||l.areAllShipsSunk()){let e="";r.areAllShipsSunk()?e="Computer Fleet wins!":l.areAllShipsSunk()&&(e="Human Fleet wins!"),p.removeEventListener("click",c),d.renderWinner(e)}}},s=()=>{p.addEventListener("click",(e=>{d.startGame(),c(e)}))};return{renderGrids:i,addAttackEventListener:s,autoPlace:()=>{r.reset(),r.autoPlaceFleet(e.getFleet()),l.autoPlaceFleet(t.getFleet()),i(),s()}}},m=document.querySelector(".auto-place"),y=document.querySelector(".play-again"),S=document.querySelector(".my-link");g().renderGrids(),m.addEventListener("click",(()=>{g().autoPlace()})),y.addEventListener("click",(()=>{S.click()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LHVCQUNGVSxFQUFRckQsb0JBQ2YyQyxFQUFTLHFCQUViTSxFQUFPVyxvQkFBb0IsUUFBU3JDLEdBQ3BDLGVBQTJCb0IsTUFJakNrQixFQUF5QixLQUMzQlosRUFBT2EsaUJBQWlCLFNBQVVQLElBQzlCLGNBQ0FoQyxFQUFPZ0MsT0FZZixNQUFPLENBQUVELFlBQUFBLEVBQWFPLHVCQUFBQSxFQUF3Qm5FLFVBUjVCLEtBQ2QwRCxFQUFRbEQsUUFDUmtELEVBQVFqRCxlQUFlK0MsRUFBRzVCLFlBQzFCK0IsRUFBUWxELGVBQWVnRCxFQUFHN0IsWUFDMUJnQyxJQUNBTyxPQ3RERixFQUFlbEMsU0FBU0MsY0FBYyxlQUN0Q21DLEVBQWVwQyxTQUFTQyxjQUFjLGVBQ3RDLEVBQU9ELFNBQVNDLGNBQWMsWUFFcEMsSUFBTzBCLGNBRVAsRUFBYVEsaUJBQWlCLFNBQVMsS0FDbkMsSUFBT3BFLGVBR1hxRSxFQUFhRCxpQkFBaUIsU0FBUyxLQUNuQyxFQUFLRSxZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZEZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL3NoaXBGYWN0b3J5LmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9wbGF5ZXJGYWN0b3J5LmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9kb20uanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2dhbWUuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBzaGlwcyA9IFtcbiAgICAnY2FycmllcicsXG4gICAgJ2JhdHRsZXNoaXAnLFxuICAgICdjcnVpc2VyJyxcbiAgICAnc3VibWFyaW5lJyxcbiAgICAnZGVzdHJveWVyJyxcbl1cblxuY29uc3QgcmFuZG9tID0gKHNpemUpID0+IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNpemUpIC8vIDAgdG8gMTAgaW50XG5leHBvcnQgY29uc3QgcmFuZG9tQ29vcmRpbmF0ZXMgPSAoc2l6ZSA9IDEwKSA9PiBbcmFuZG9tKHNpemUpLCByYW5kb20oc2l6ZSldXG5cbmNvbnN0IGdhbWVib2FyZEZhY3RvcnkgPSAoKSA9PiB7XG4gICAgLy8gY3JlYXRlIDEweDEwIGdyaWQgdy8gbXVsdGlkaW1lbnNpb25hbCBhcnJheVxuICAgIGxldCBib2FyZCA9IEFycmF5KDEwKVxuICAgICAgICAuZmlsbChudWxsKVxuICAgICAgICAubWFwKCgpID0+IEFycmF5KDEwKS5maWxsKG51bGwpKVxuICAgIGNvbnN0IGdldEJvYXJkID0gKCkgPT4gYm9hcmRcblxuICAgIGxldCBwbGFjZWRTaGlwcyA9IFtdXG4gICAgY29uc3QgYXJlQWxsU2hpcHNQbGFjZWQgPSAoKSA9PiBwbGFjZWRTaGlwcy5sZW5ndGggPT09IHNoaXBzLmxlbmd0aFxuXG4gICAgLy8gYmFzZWQgb24gdGhlIHdoaWNoIGF4aXMgaXMgaXQsIGZyb20gd2hlcmUgKGNvb3JkaW5hdGVzKSB0byB3aGVyZSAobGVuZ3RoIC8gaSkgdG8gYnVpbGQgaXRcbiAgICBjb25zdCBhZGp1c3RDb29yZGluYXRlcyA9ICh5MCwgeDAsIGksIGRpcmVjdGlvbikgPT4ge1xuICAgICAgICAvLyBkZWZhdWx0IC0gaG9yaXpvbnRhbFxuICAgICAgICBsZXQgeCA9IHgwICsgaVxuICAgICAgICBsZXQgeSA9IHkwXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgIHggPSB4MFxuICAgICAgICAgICAgeSA9IHkwICsgaVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbeSwgeF1cbiAgICB9XG5cbiAgICBjb25zdCBjaGVja1ZhbGlkID0gKGxlbmd0aCwgZGlyZWN0aW9uLCB5MCwgeDApID0+IHtcbiAgICAgICAgY29uc3QgY2VsbHMgPSBbXVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBbeSwgeF0gPSBhZGp1c3RDb29yZGluYXRlcyh5MCwgeDAsIGksIGRpcmVjdGlvbilcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIG91dCBvZiBib3VuZHNcbiAgICAgICAgICAgIGlmICh5IDwgMTAgJiYgeCA8IDEwKSB7XG4gICAgICAgICAgICAgICAgY2VsbHMucHVzaChib2FyZFt5XVt4XSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNlbGxzLmV2ZXJ5KChjZWxsKSA9PiBjZWxsID09PSBudWxsKVxuICAgIH1cblxuICAgIC8vIHBsYWNlIHNoaXAgYXQgY29vcmRpbmF0ZXMgKHksIHgpXG4gICAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIHkwLCB4MCkgPT4ge1xuICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSBzaGlwLmdldERpcmVjdGlvbigpXG4gICAgICAgIGNvbnN0IHZhbGlkID0gY2hlY2tWYWxpZChzaGlwLmxlbmd0aCwgZGlyZWN0aW9uLCB5MCwgeDApXG4gICAgICAgIGlmICh2YWxpZCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3ksIHhdID0gYWRqdXN0Q29vcmRpbmF0ZXMoeTAsIHgwLCBpLCBkaXJlY3Rpb24pXG4gICAgICAgICAgICAgICAgYm9hcmRbeV1beF0gPSB7IHNoaXAsIGluZGV4OiBpIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcClcbiAgICAgICAgICAgIHJldHVybiB2YWxpZFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWxpZFxuICAgIH1cblxuICAgIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoeSwgeCkgPT4ge1xuICAgICAgICBpZiAoYm9hcmRbeV1beF0gPT09IG51bGwpIHtcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdID0gJ21pc3MnIC8vIHJlY29yZHMgbWlzc2VkIHNob3RcbiAgICAgICAgfSBlbHNlIGlmIChib2FyZFt5XVt4XS5zaGlwKSB7XG4gICAgICAgICAgICBib2FyZFt5XVt4XS5zaGlwLmhpdChib2FyZFt5XVt4XS5pbmRleClcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdID0gJ2hpdCcgLy8gcmVjb3JkcyBoaXRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYm9hcmRbeV1beF1cbiAgICB9XG5cbiAgICBjb25zdCBhcmVBbGxTaGlwc1N1bmsgPSAoKSA9PiBwbGFjZWRTaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSlcblxuICAgIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgICAgICBib2FyZCA9IEFycmF5KDEwKVxuICAgICAgICAgICAgLmZpbGwobnVsbClcbiAgICAgICAgICAgIC5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwobnVsbCkpXG4gICAgICAgIHBsYWNlZFNoaXBzID0gW11cbiAgICB9XG5cbiAgICBjb25zdCBhdXRvUGxhY2UgPSAoc2hpcCkgPT4ge1xuICAgICAgICAvLyBtaWdodCB1cGRhdGUgaXQgdG8gbm90IHBsYWNlIGlmIHRoZXJlIGFyZSBuZWFyYnkgc2hpcHNcbiAgICAgICAgY29uc3QgW3ksIHhdID0gcmFuZG9tQ29vcmRpbmF0ZXMoKVxuICAgICAgICBjb25zdCBjaGFuZ2VPcmllbnQgPSBNYXRoLnJhbmRvbSgpID4gMC41XG4gICAgICAgIGlmIChjaGFuZ2VPcmllbnQpIHNoaXAuY2hhbmdlRGlyZWN0aW9uKClcbiAgICAgICAgY29uc3QgcGxhY2VkID0gcGxhY2VTaGlwKHNoaXAsIHksIHgpXG4gICAgICAgIGlmICghcGxhY2VkKSBhdXRvUGxhY2Uoc2hpcClcbiAgICB9XG5cbiAgICBjb25zdCBhdXRvUGxhY2VGbGVldCA9IChmbGVldCkgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IHNoaXAgaW4gZmxlZXQpIHtcbiAgICAgICAgICAgIGF1dG9QbGFjZShmbGVldFtzaGlwXSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdldEJvYXJkLFxuICAgICAgICBhcmVBbGxTaGlwc1BsYWNlZCxcbiAgICAgICAgcGxhY2VTaGlwLFxuICAgICAgICByZWNlaXZlQXR0YWNrLFxuICAgICAgICBhcmVBbGxTaGlwc1N1bmssXG4gICAgICAgIHJlc2V0LFxuICAgICAgICBhdXRvUGxhY2VGbGVldCxcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWVib2FyZEZhY3RvcnlcbiIsImNvbnN0IHNoaXBMZW5ndGhzID0ge1xuICAgIGNhcnJpZXI6IDUsXG4gICAgYmF0dGxlc2hpcDogNCxcbiAgICBjcnVpc2VyOiAzLFxuICAgIHN1Ym1hcmluZTogMyxcbiAgICBkZXN0cm95ZXI6IDIsXG59XG5cbmNvbnN0IHNoaXBGYWN0b3J5ID0gKHR5cGUpID0+IHtcbiAgICAvLyBQcm9wZXJ0aWVzXG4gICAgY29uc3QgaWQgPSB0eXBlXG4gICAgY29uc3QgbGVuZ3RoID0gc2hpcExlbmd0aHNbdHlwZV1cbiAgICBsZXQgZGlyZWN0aW9uID0gJ2hvcml6b250YWwnXG5cbiAgICBjb25zdCBnZXREaXJlY3Rpb24gPSAoKSA9PiBkaXJlY3Rpb25cbiAgICBjb25zdCBjaGFuZ2VEaXJlY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgIGRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnXG4gICAgICAgICAgICA/IChkaXJlY3Rpb24gPSAndmVydGljYWwnKVxuICAgICAgICAgICAgOiAoZGlyZWN0aW9uID0gJ2hvcml6b250YWwnKVxuICAgIH1cblxuICAgIC8vIEhpdCBmdW5jdGlvblxuICAgIGNvbnN0IGhpdHMgPSBBcnJheShsZW5ndGgpLmZpbGwobnVsbClcbiAgICBjb25zdCBoaXQgPSAoaSkgPT4gKGhpdHNbaV0gPSAnaGl0JylcbiAgICBjb25zdCBnZXRIaXRzID0gKCkgPT4gaGl0c1xuXG4gICAgLy8gU3VuayBmdW5jdGlvblxuICAgIGNvbnN0IGlzU3VuayA9ICgpID0+IGhpdHMuZXZlcnkoKGgpID0+IGggPT09ICdoaXQnKVxuXG4gICAgcmV0dXJuIHsgaWQsIGxlbmd0aCwgZ2V0RGlyZWN0aW9uLCBjaGFuZ2VEaXJlY3Rpb24sIGhpdCwgZ2V0SGl0cywgaXNTdW5rIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgc2hpcEZhY3RvcnlcbiIsImltcG9ydCB7IHNoaXBzLCByYW5kb21Db29yZGluYXRlcyB9IGZyb20gJy4vZ2FtZWJvYXJkRmFjdG9yeSdcbmltcG9ydCBzaGlwRmFjdG9yeSBmcm9tICcuL3NoaXBGYWN0b3J5J1xuXG5jb25zdCBjcmVhdGVGbGVldCA9ICh0eXBlcykgPT4ge1xuICAgIGNvbnN0IGZsZWV0ID0ge31cbiAgICB0eXBlcy5mb3JFYWNoKCh0eXBlKSA9PiAoZmxlZXRbdHlwZV0gPSBzaGlwRmFjdG9yeSh0eXBlKSkpXG4gICAgcmV0dXJuIGZsZWV0XG59XG5cbmNvbnN0IHBsYXllciA9ICh0eXBlKSA9PiB7XG4gICAgbGV0IGZsZWV0ID0gY3JlYXRlRmxlZXQoc2hpcHMpXG5cbiAgICBjb25zdCBnZXRUeXBlID0gKCkgPT4gdHlwZVxuICAgIGNvbnN0IGdldEZsZWV0ID0gKCkgPT4gZmxlZXRcblxuICAgIGNvbnN0IGF0dGFjayA9ICh5LCB4LCBjb21wdXRlckJvYXJkKSA9PiBjb21wdXRlckJvYXJkLnJlY2VpdmVBdHRhY2soeSwgeClcblxuICAgIGNvbnN0IGF1dG9BdHRhY2sgPSAoaHVtYW5Cb2FyZCkgPT4ge1xuICAgICAgICBjb25zdCBbeSwgeF0gPSByYW5kb21Db29yZGluYXRlcygpXG4gICAgICAgIGNvbnN0IGNlbGwgPSBodW1hbkJvYXJkLmdldEJvYXJkKClbeV1beF1cbiAgICAgICAgaWYgKGNlbGwgPT09ICdtaXNzJyB8fCBjZWxsID09PSAnaGl0Jykge1xuICAgICAgICAgICAgYXV0b0F0dGFjayhodW1hbkJvYXJkKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaHVtYW5Cb2FyZC5yZWNlaXZlQXR0YWNrKHksIHgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXNldEZsZWV0ID0gKCkgPT4gKGZsZWV0ID0gY3JlYXRlRmxlZXQoc2hpcHMpKVxuXG4gICAgcmV0dXJuIHsgZ2V0VHlwZSwgZ2V0RmxlZXQsIGF0dGFjaywgYXV0b0F0dGFjaywgcmVzZXRGbGVldCB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHBsYXllclxuIiwiY29uc3Qgd2lubmVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndpbm5lci1jb250YWluZXInKVxuY29uc3Qgd2lubmVySW5mbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW5uZXItaW5mbycpXG5jb25zdCBidXR0b25zQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMtY29udGFpbmVyJylcbmNvbnN0IGF1dG9QbGFjZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdXRvLXBsYWNlJylcblxuY29uc3QgZ2FtZWJvYXJkVmlldyA9ICgoKSA9PiB7XG4gICAgY29uc3QgcmVuZGVyQ2VsbCA9ICh5LCB4LCBzdGF0dXMpID0+XG4gICAgICAgIGA8ZGl2IGNsYXNzPVwiZ3JpZC1jZWxsIGNlbGwtJHt5fS0ke3h9ICR7c3RhdHVzfVwiIGRhdGEteT0nJHt5fScgZGF0YS14PScke3h9Jz48L2Rpdj5gXG5cbiAgICBjb25zdCBjbGVhckdyaWQgPSAocGFyZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGdyaWQgPSBwYXJlbnRcbiAgICAgICAgZ3JpZC50ZXh0Q29udGVudCA9ICcnXG4gICAgfVxuXG4gICAgY29uc3QgcmVuZGVyR3JpZCA9IChwYXJlbnQsIGdhbWVib2FyZCwgdHlwZSkgPT4ge1xuICAgICAgICBjbGVhckdyaWQocGFyZW50KVxuICAgICAgICBjb25zdCBib2FyZCA9IGdhbWVib2FyZC5nZXRCb2FyZCgpXG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBib2FyZFxuICAgICAgICBsZXQgZ3JpZCA9ICcnXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgc3RhdHVzID0gYm9hcmRbaV1bal1cbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICcnXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMuc2hpcCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2h1bWFuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gc3RhdHVzLnNoaXAuaWRcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICcnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZ3JpZCArPSByZW5kZXJDZWxsKGksIGosIHN0YXR1cylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgZ3JpZClcbiAgICB9XG5cbiAgICBjb25zdCByZW5kZXJXaW5uZXIgPSAod2lubmVyKSA9PiB7XG4gICAgICAgIHdpbm5lckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxuICAgICAgICB3aW5uZXJJbmZvLnRleHRDb250ZW50ID0gd2lubmVyXG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlIGJ1dHRvbnMgb24gc3RhcnRcbiAgICBjb25zdCBzdGFydEdhbWUgPSAoKSA9PiB7XG4gICAgICAgIGJ1dHRvbnNDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZScpXG4gICAgICAgIGF1dG9QbGFjZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpXG4gICAgfVxuXG4gICAgLyogY29uc3QgcGxheUFnYWluID0gKCkgPT4ge1xuICAgICAgICB3aW5uZXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJylcbiAgICAgICAgYnV0dG9uc0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJylcbiAgICAgICAgYXV0b1BsYWNlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJylcbiAgICB9ICovXG5cbiAgICByZXR1cm4geyByZW5kZXJHcmlkLCByZW5kZXJXaW5uZXIsIHN0YXJ0R2FtZSAvKiAsIHBsYXlBZ2FpbiAqLyB9XG59KSgpXG5leHBvcnQgZGVmYXVsdCBnYW1lYm9hcmRWaWV3XG4iLCJpbXBvcnQgcGxheWVyIGZyb20gJy4vcGxheWVyRmFjdG9yeSdcbmltcG9ydCBnYW1lYm9hcmRGYWN0b3J5IGZyb20gJy4vZ2FtZWJvYXJkRmFjdG9yeSdcbmltcG9ydCBnYW1lYm9hcmRWaWV3IGZyb20gJy4vZG9tJ1xuXG5jb25zdCBwMUdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZC1wMScpXG5jb25zdCBwMkdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZC1wMicpXG5cbmNvbnN0IGdhbWUgPSAoKSA9PiB7XG4gICAgY29uc3QgcDEgPSBwbGF5ZXIoJ2h1bWFuJylcbiAgICBjb25zdCBwMiA9IHBsYXllcignY29tcHV0ZXInKVxuXG4gICAgY29uc3QgcDFCb2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKVxuICAgIGNvbnN0IHAyQm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KClcblxuICAgIGNvbnN0IHJlbmRlckdyaWRzID0gKCkgPT4ge1xuICAgICAgICBnYW1lYm9hcmRWaWV3LnJlbmRlckdyaWQocDFHcmlkLCBwMUJvYXJkLCBwMS5nZXRUeXBlKCkpXG4gICAgICAgIGdhbWVib2FyZFZpZXcucmVuZGVyR3JpZChwMkdyaWQsIHAyQm9hcmQsIHAyLmdldFR5cGUoKSlcbiAgICB9XG5cbiAgICBjb25zdCBhdHRhY2sgPSAoZSkgPT4ge1xuICAgICAgICBjb25zdCBjZWxsID0gZS50YXJnZXRcbiAgICAgICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdncmlkLWNlbGwnKSkge1xuICAgICAgICAgICAgY29uc3QgeyB5IH0gPSBjZWxsLmRhdGFzZXRcbiAgICAgICAgICAgIGNvbnN0IHsgeCB9ID0gY2VsbC5kYXRhc2V0XG5cbiAgICAgICAgICAgIGNvbnN0IGJvYXJkQ2VsbCA9IHAyQm9hcmQuZ2V0Qm9hcmQoKVt5XVt4XVxuICAgICAgICAgICAgaWYgKGJvYXJkQ2VsbCAhPT0gJ21pc3MnICYmIGJvYXJkQ2VsbCAhPT0gJ2hpdCcpIHtcbiAgICAgICAgICAgICAgICBwMS5hdHRhY2soeSwgeCwgcDJCb2FyZClcbiAgICAgICAgICAgICAgICBwMi5hdXRvQXR0YWNrKHAxQm9hcmQpXG5cbiAgICAgICAgICAgICAgICByZW5kZXJHcmlkcygpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocDFCb2FyZC5hcmVBbGxTaGlwc1N1bmsoKSB8fCBwMkJvYXJkLmFyZUFsbFNoaXBzU3VuaygpKSB7XG4gICAgICAgICAgICAgICAgbGV0IHdpbm5lciA9ICcnXG4gICAgICAgICAgICAgICAgaWYgKHAxQm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgd2lubmVyID0gJ0NvbXB1dGVyIEZsZWV0IHdpbnMhJ1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocDJCb2FyZC5hcmVBbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5uZXIgPSAnSHVtYW4gRmxlZXQgd2lucyEnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHAyR3JpZC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGF0dGFjaylcbiAgICAgICAgICAgICAgICBnYW1lYm9hcmRWaWV3LnJlbmRlcldpbm5lcih3aW5uZXIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgYWRkQXR0YWNrRXZlbnRMaXN0ZW5lciA9ICgpID0+IHtcbiAgICAgICAgcDJHcmlkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGdhbWVib2FyZFZpZXcuc3RhcnRHYW1lKClcbiAgICAgICAgICAgIGF0dGFjayhlKVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IGF1dG9QbGFjZSA9ICgpID0+IHtcbiAgICAgICAgcDFCb2FyZC5yZXNldCgpXG4gICAgICAgIHAxQm9hcmQuYXV0b1BsYWNlRmxlZXQocDEuZ2V0RmxlZXQoKSlcbiAgICAgICAgcDJCb2FyZC5hdXRvUGxhY2VGbGVldChwMi5nZXRGbGVldCgpKVxuICAgICAgICByZW5kZXJHcmlkcygpXG4gICAgICAgIGFkZEF0dGFja0V2ZW50TGlzdGVuZXIoKVxuICAgIH1cblxuICAgIHJldHVybiB7IHJlbmRlckdyaWRzLCBhZGRBdHRhY2tFdmVudExpc3RlbmVyLCBhdXRvUGxhY2UgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBnYW1lXG4iLCJpbXBvcnQgZ2FtZSBmcm9tICcuL2dhbWUnXG5cbmNvbnN0IGF1dG9QbGFjZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdXRvLXBsYWNlJylcbmNvbnN0IHBsYXlBZ2FpbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5LWFnYWluJylcbmNvbnN0IGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktbGluaycpXG5cbmdhbWUoKS5yZW5kZXJHcmlkcygpXG5cbmF1dG9QbGFjZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBnYW1lKCkuYXV0b1BsYWNlKClcbn0pXG5cbnBsYXlBZ2FpbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBsaW5rLmNsaWNrKClcbn0pXG4iXSwibmFtZXMiOlsic2hpcHMiLCJyYW5kb20iLCJzaXplIiwiTWF0aCIsImZsb29yIiwicmFuZG9tQ29vcmRpbmF0ZXMiLCJib2FyZCIsIkFycmF5IiwiZmlsbCIsIm1hcCIsInBsYWNlZFNoaXBzIiwiYWRqdXN0Q29vcmRpbmF0ZXMiLCJ5MCIsIngwIiwiaSIsImRpcmVjdGlvbiIsIngiLCJ5IiwicGxhY2VTaGlwIiwic2hpcCIsImdldERpcmVjdGlvbiIsInZhbGlkIiwibGVuZ3RoIiwiY2VsbHMiLCJwdXNoIiwiZXZlcnkiLCJjZWxsIiwiY2hlY2tWYWxpZCIsImluZGV4IiwiYXV0b1BsYWNlIiwiY2hhbmdlRGlyZWN0aW9uIiwiZ2V0Qm9hcmQiLCJhcmVBbGxTaGlwc1BsYWNlZCIsInJlY2VpdmVBdHRhY2siLCJoaXQiLCJhcmVBbGxTaGlwc1N1bmsiLCJpc1N1bmsiLCJyZXNldCIsImF1dG9QbGFjZUZsZWV0IiwiZmxlZXQiLCJzaGlwTGVuZ3RocyIsImNhcnJpZXIiLCJiYXR0bGVzaGlwIiwiY3J1aXNlciIsInN1Ym1hcmluZSIsImRlc3Ryb3llciIsImNyZWF0ZUZsZWV0IiwidHlwZXMiLCJmb3JFYWNoIiwidHlwZSIsImlkIiwiaGl0cyIsImdldEhpdHMiLCJoIiwiYXV0b0F0dGFjayIsImh1bWFuQm9hcmQiLCJnZXRUeXBlIiwiZ2V0RmxlZXQiLCJhdHRhY2siLCJjb21wdXRlckJvYXJkIiwicmVzZXRGbGVldCIsIndpbm5lckNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIndpbm5lckluZm8iLCJidXR0b25zQ29udGFpbmVyIiwiYXV0b1BsYWNlQnRuIiwicmVuZGVyQ2VsbCIsInN0YXR1cyIsInJlbmRlckdyaWQiLCJwYXJlbnQiLCJnYW1lYm9hcmQiLCJ0ZXh0Q29udGVudCIsImNsZWFyR3JpZCIsImdyaWQiLCJqIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwicmVuZGVyV2lubmVyIiwid2lubmVyIiwiY2xhc3NMaXN0IiwiYWRkIiwic3RhcnRHYW1lIiwic2V0QXR0cmlidXRlIiwicDFHcmlkIiwicDJHcmlkIiwicDEiLCJwMiIsInAxQm9hcmQiLCJwMkJvYXJkIiwicmVuZGVyR3JpZHMiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJkYXRhc2V0IiwiYm9hcmRDZWxsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEF0dGFja0V2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwicGxheUFnYWluQnRuIiwiY2xpY2siXSwic291cmNlUm9vdCI6IiJ9