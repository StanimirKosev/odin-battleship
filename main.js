(()=>{"use strict";const e=["carrier","battleship","cruiser","submarine","destroyer"],t=e=>Math.floor(Math.random()*e),r=(e=10)=>[t(e),t(e)],i=()=>{let t=Array(10).fill(null).map((()=>Array(10).fill(null))),i=[];const n=(e,t,r,i)=>{let n=t+r,l=e;return"vertical"===i&&(n=t,l=e+r),[l,n]},l=(e,r,l)=>{const a=e.getDirection(),c=((e,r,i,l)=>{const a=[];for(let c=0;c<e;c++){const[e,s]=n(i,l,c,r);if(!(e<10&&s<10))return!1;a.push(t[e][s])}return a.every((e=>null===e))})(e.length,a,r,l);if(c){for(let i=0;i<e.length;i++){const[c,s]=n(r,l,i,a);t[c][s]={ship:e,index:i}}return i.push(e),c}return c},a=e=>{const[t,i]=r();Math.random()>.5&&e.changeDirection(),l(e,t,i)||a(e)};return{getBoard:()=>t,areAllShipsPlaced:()=>i.length===e.length,placeShip:l,receiveAttack:(e,r)=>(null===t[e][r]?t[e][r]="miss":t[e][r].ship&&(t[e][r].ship.hit(t[e][r].index),t[e][r]="hit"),t[e][r]),areAllShipsSunk:()=>i.every((e=>e.isSunk())),reset:()=>{t=Array(10).fill(null).map((()=>Array(10).fill(null))),i=[]},autoPlaceFleet:e=>{for(const t in e)a(e[t])}}},n={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2},l=e=>{const t=e,r=n[e];let i="horizontal";const l=Array(r).fill(null);return{id:t,length:r,getDirection:()=>i,changeDirection:()=>{i="horizontal"===i?"vertical":"horizontal"},hit:e=>l[e]="hit",getHits:()=>l,isSunk:()=>l.every((e=>"hit"===e))}},a=e=>{const t={};return e.forEach((e=>t[e]=l(e))),t},c=t=>{let i=a(e);const n=e=>{const[t,i]=r(),l=e.getBoard()[t][i];"miss"===l||"hit"===l?n(e):e.receiveAttack(t,i)};return{getType:()=>t,getFleet:()=>i,attack:(e,t,r)=>r.receiveAttack(e,t),autoAttack:n,resetFleet:()=>i=a(e)}},s=(()=>{const e=(e,t,r)=>`<div class="grid-cell cell-${e}-${t} ${r}" data-y='${e}' data-x='${t}'></div>`;return{renderGrid:(t,r,i)=>{const n=r.getBoard(),{length:l}=n;let a="";for(let t=0;t<l;t++)for(let r=0;r<l;r++){let i=n[t][r];null===i?i="":i.ship&&(i=i.ship.id),a+=e(t,r,i)}t.insertAdjacentHTML("afterbegin",a)}}})(),o=document.querySelector(".grid-p1"),h=document.querySelector(".grid-p2");(()=>{const e=c("human"),t=c("computer"),r=i(),n=i(),a=l("carrier");r.placeShip(a,0,0);const u=l("battleship");return n.placeShip(u,0,0),{renderGrids:()=>{s.renderGrid(o,r,e.getType()),s.renderGrid(h,n,t.getType())}}})().renderGrids()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTQSxFQUFPM0MsS0FBSzRCLElBS3pCbUIsR0FBUUwsRUFBVy9DLEVBQUdxRCxFQUFHTCxHQUdqQ0UsRUFBT0ksbUJBQW1CLGFBQWNGLE1BdkIxQixHQ0toQkcsRUFBU0MsU0FBU0MsY0FBYyxZQUNoQ0MsRUFBU0YsU0FBU0MsY0FBYyxZQUV6QixNQUVULE1BQU1FLEVBQUssRUFBTyxTQUNaQyxFQUFLLEVBQU8sWUFHWkMsRUFBVSxJQUNWQyxFQUFVLElBR1ZuQyxFQUFVLEVBQVksV0FDNUJrQyxFQUFRekQsVUFBVXVCLEVBQVMsRUFBRyxHQUM5QixNQUFNQyxFQUFhLEVBQVksY0FPL0IsT0FOQWtDLEVBQVExRCxVQUFVd0IsRUFBWSxFQUFHLEdBTTFCLENBQUVtQyxZQUpXLEtBQ2hCLGFBQXlCUixFQUFRTSxFQUFTRixFQUFHakIsV0FDN0MsYUFBeUJnQixFQUFRSSxFQUFTRixFQUFHbEIsY0N2QnJELEdBQU9xQixlIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZEZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL3NoaXBGYWN0b3J5LmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9wbGF5ZXJGYWN0b3J5LmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9kb20uanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2dhbWUuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBzaGlwcyA9IFtcbiAgICAnY2FycmllcicsXG4gICAgJ2JhdHRsZXNoaXAnLFxuICAgICdjcnVpc2VyJyxcbiAgICAnc3VibWFyaW5lJyxcbiAgICAnZGVzdHJveWVyJyxcbl1cblxuY29uc3QgcmFuZG9tID0gKHNpemUpID0+IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNpemUpIC8vIDAgdG8gMTAgaW50XG5leHBvcnQgY29uc3QgcmFuZG9tQ29vcmRpbmF0ZXMgPSAoc2l6ZSA9IDEwKSA9PiBbcmFuZG9tKHNpemUpLCByYW5kb20oc2l6ZSldXG5cbmNvbnN0IGdhbWVib2FyZEZhY3RvcnkgPSAoKSA9PiB7XG4gICAgLy8gY3JlYXRlIDEweDEwIGdyaWQgdy8gbXVsdGlkaW1lbnNpb25hbCBhcnJheVxuICAgIGxldCBib2FyZCA9IEFycmF5KDEwKVxuICAgICAgICAuZmlsbChudWxsKVxuICAgICAgICAubWFwKCgpID0+IEFycmF5KDEwKS5maWxsKG51bGwpKVxuICAgIGNvbnN0IGdldEJvYXJkID0gKCkgPT4gYm9hcmRcblxuICAgIGxldCBwbGFjZWRTaGlwcyA9IFtdXG4gICAgY29uc3QgYXJlQWxsU2hpcHNQbGFjZWQgPSAoKSA9PiBwbGFjZWRTaGlwcy5sZW5ndGggPT09IHNoaXBzLmxlbmd0aFxuXG4gICAgLy8gYmFzZWQgb24gdGhlIHdoaWNoIGF4aXMgaXMgaXQsIGZyb20gd2hlcmUgKGNvb3JkaW5hdGVzKSB0byB3aGVyZSAobGVuZ3RoIC8gaSkgdG8gYnVpbGQgaXRcbiAgICBjb25zdCBhZGp1c3RDb29yZGluYXRlcyA9ICh5MCwgeDAsIGksIGRpcmVjdGlvbikgPT4ge1xuICAgICAgICAvLyBkZWZhdWx0IC0gaG9yaXpvbnRhbFxuICAgICAgICBsZXQgeCA9IHgwICsgaVxuICAgICAgICBsZXQgeSA9IHkwXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgIHggPSB4MFxuICAgICAgICAgICAgeSA9IHkwICsgaVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbeSwgeF1cbiAgICB9XG5cbiAgICBjb25zdCBjaGVja1ZhbGlkID0gKGxlbmd0aCwgZGlyZWN0aW9uLCB5MCwgeDApID0+IHtcbiAgICAgICAgY29uc3QgY2VsbHMgPSBbXVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBbeSwgeF0gPSBhZGp1c3RDb29yZGluYXRlcyh5MCwgeDAsIGksIGRpcmVjdGlvbilcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIG91dCBvZiBib3VuZHNcbiAgICAgICAgICAgIGlmICh5IDwgMTAgJiYgeCA8IDEwKSB7XG4gICAgICAgICAgICAgICAgY2VsbHMucHVzaChib2FyZFt5XVt4XSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNlbGxzLmV2ZXJ5KChjZWxsKSA9PiBjZWxsID09PSBudWxsKVxuICAgIH1cblxuICAgIC8vIHBsYWNlIHNoaXAgYXQgY29vcmRpbmF0ZXMgKHksIHgpXG4gICAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIHkwLCB4MCkgPT4ge1xuICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSBzaGlwLmdldERpcmVjdGlvbigpXG4gICAgICAgIGNvbnN0IHZhbGlkID0gY2hlY2tWYWxpZChzaGlwLmxlbmd0aCwgZGlyZWN0aW9uLCB5MCwgeDApXG4gICAgICAgIGlmICh2YWxpZCkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3ksIHhdID0gYWRqdXN0Q29vcmRpbmF0ZXMoeTAsIHgwLCBpLCBkaXJlY3Rpb24pXG4gICAgICAgICAgICAgICAgYm9hcmRbeV1beF0gPSB7IHNoaXAsIGluZGV4OiBpIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcClcbiAgICAgICAgICAgIHJldHVybiB2YWxpZFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWxpZFxuICAgIH1cblxuICAgIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoeSwgeCkgPT4ge1xuICAgICAgICBpZiAoYm9hcmRbeV1beF0gPT09IG51bGwpIHtcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdID0gJ21pc3MnIC8vIHJlY29yZHMgbWlzc2VkIHNob3RcbiAgICAgICAgfSBlbHNlIGlmIChib2FyZFt5XVt4XS5zaGlwKSB7XG4gICAgICAgICAgICBib2FyZFt5XVt4XS5zaGlwLmhpdChib2FyZFt5XVt4XS5pbmRleClcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdID0gJ2hpdCcgLy8gcmVjb3JkcyBoaXRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYm9hcmRbeV1beF1cbiAgICB9XG5cbiAgICBjb25zdCBhcmVBbGxTaGlwc1N1bmsgPSAoKSA9PiBwbGFjZWRTaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSlcblxuICAgIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgICAgICBib2FyZCA9IEFycmF5KDEwKVxuICAgICAgICAgICAgLmZpbGwobnVsbClcbiAgICAgICAgICAgIC5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwobnVsbCkpXG4gICAgICAgIHBsYWNlZFNoaXBzID0gW11cbiAgICB9XG5cbiAgICBjb25zdCBhdXRvUGxhY2UgPSAoc2hpcCkgPT4ge1xuICAgICAgICBjb25zdCBbeSwgeF0gPSByYW5kb21Db29yZGluYXRlcygpXG4gICAgICAgIGNvbnN0IGNoYW5nZU9yaWVudCA9IE1hdGgucmFuZG9tKCkgPiAwLjVcbiAgICAgICAgaWYgKGNoYW5nZU9yaWVudCkgc2hpcC5jaGFuZ2VEaXJlY3Rpb24oKVxuICAgICAgICBjb25zdCBwbGFjZWQgPSBwbGFjZVNoaXAoc2hpcCwgeSwgeClcbiAgICAgICAgaWYgKCFwbGFjZWQpIGF1dG9QbGFjZShzaGlwKVxuICAgIH1cblxuICAgIGNvbnN0IGF1dG9QbGFjZUZsZWV0ID0gKGZsZWV0KSA9PiB7XG4gICAgICAgIGZvciAoY29uc3Qgc2hpcCBpbiBmbGVldCkge1xuICAgICAgICAgICAgYXV0b1BsYWNlKGZsZWV0W3NoaXBdKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0Qm9hcmQsXG4gICAgICAgIGFyZUFsbFNoaXBzUGxhY2VkLFxuICAgICAgICBwbGFjZVNoaXAsXG4gICAgICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgICAgIGFyZUFsbFNoaXBzU3VuayxcbiAgICAgICAgcmVzZXQsXG4gICAgICAgIGF1dG9QbGFjZUZsZWV0LFxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgZ2FtZWJvYXJkRmFjdG9yeVxuIiwiY29uc3Qgc2hpcExlbmd0aHMgPSB7XG4gICAgY2FycmllcjogNSxcbiAgICBiYXR0bGVzaGlwOiA0LFxuICAgIGNydWlzZXI6IDMsXG4gICAgc3VibWFyaW5lOiAzLFxuICAgIGRlc3Ryb3llcjogMixcbn1cblxuY29uc3Qgc2hpcEZhY3RvcnkgPSAodHlwZSkgPT4ge1xuICAgIC8vIFByb3BlcnRpZXNcbiAgICBjb25zdCBpZCA9IHR5cGVcbiAgICBjb25zdCBsZW5ndGggPSBzaGlwTGVuZ3Roc1t0eXBlXVxuICAgIGxldCBkaXJlY3Rpb24gPSAnaG9yaXpvbnRhbCdcblxuICAgIGNvbnN0IGdldERpcmVjdGlvbiA9ICgpID0+IGRpcmVjdGlvblxuICAgIGNvbnN0IGNoYW5nZURpcmVjdGlvbiA9ICgpID0+IHtcbiAgICAgICAgZGlyZWN0aW9uID09PSAnaG9yaXpvbnRhbCdcbiAgICAgICAgICAgID8gKGRpcmVjdGlvbiA9ICd2ZXJ0aWNhbCcpXG4gICAgICAgICAgICA6IChkaXJlY3Rpb24gPSAnaG9yaXpvbnRhbCcpXG4gICAgfVxuXG4gICAgLy8gSGl0IGZ1bmN0aW9uXG4gICAgY29uc3QgaGl0cyA9IEFycmF5KGxlbmd0aCkuZmlsbChudWxsKVxuICAgIGNvbnN0IGhpdCA9IChpKSA9PiAoaGl0c1tpXSA9ICdoaXQnKVxuICAgIGNvbnN0IGdldEhpdHMgPSAoKSA9PiBoaXRzXG5cbiAgICAvLyBTdW5rIGZ1bmN0aW9uXG4gICAgY29uc3QgaXNTdW5rID0gKCkgPT4gaGl0cy5ldmVyeSgoaCkgPT4gaCA9PT0gJ2hpdCcpXG5cbiAgICByZXR1cm4geyBpZCwgbGVuZ3RoLCBnZXREaXJlY3Rpb24sIGNoYW5nZURpcmVjdGlvbiwgaGl0LCBnZXRIaXRzLCBpc1N1bmsgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBzaGlwRmFjdG9yeVxuIiwiaW1wb3J0IHsgc2hpcHMsIHJhbmRvbUNvb3JkaW5hdGVzIH0gZnJvbSAnLi9nYW1lYm9hcmRGYWN0b3J5J1xuaW1wb3J0IHNoaXBGYWN0b3J5IGZyb20gJy4vc2hpcEZhY3RvcnknXG5cbmNvbnN0IGNyZWF0ZUZsZWV0ID0gKHR5cGVzKSA9PiB7XG4gICAgY29uc3QgZmxlZXQgPSB7fVxuICAgIHR5cGVzLmZvckVhY2goKHR5cGUpID0+IChmbGVldFt0eXBlXSA9IHNoaXBGYWN0b3J5KHR5cGUpKSlcbiAgICByZXR1cm4gZmxlZXRcbn1cblxuY29uc3QgcGxheWVyID0gKHR5cGUpID0+IHtcbiAgICBsZXQgZmxlZXQgPSBjcmVhdGVGbGVldChzaGlwcylcblxuICAgIGNvbnN0IGdldFR5cGUgPSAoKSA9PiB0eXBlXG4gICAgY29uc3QgZ2V0RmxlZXQgPSAoKSA9PiBmbGVldFxuXG4gICAgY29uc3QgYXR0YWNrID0gKHksIHgsIGNvbXB1dGVyQm9hcmQpID0+IGNvbXB1dGVyQm9hcmQucmVjZWl2ZUF0dGFjayh5LCB4KVxuXG4gICAgY29uc3QgYXV0b0F0dGFjayA9IChodW1hbkJvYXJkKSA9PiB7XG4gICAgICAgIGNvbnN0IFt5LCB4XSA9IHJhbmRvbUNvb3JkaW5hdGVzKClcbiAgICAgICAgY29uc3QgY2VsbCA9IGh1bWFuQm9hcmQuZ2V0Qm9hcmQoKVt5XVt4XVxuICAgICAgICBpZiAoY2VsbCA9PT0gJ21pc3MnIHx8IGNlbGwgPT09ICdoaXQnKSB7XG4gICAgICAgICAgICBhdXRvQXR0YWNrKGh1bWFuQm9hcmQpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBodW1hbkJvYXJkLnJlY2VpdmVBdHRhY2soeSwgeClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlc2V0RmxlZXQgPSAoKSA9PiAoZmxlZXQgPSBjcmVhdGVGbGVldChzaGlwcykpXG5cbiAgICByZXR1cm4geyBnZXRUeXBlLCBnZXRGbGVldCwgYXR0YWNrLCBhdXRvQXR0YWNrLCByZXNldEZsZWV0IH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgcGxheWVyXG4iLCJjb25zdCBnYW1lYm9hcmRWaWV3ID0gKCgpID0+IHtcbiAgICBjb25zdCByZW5kZXJDZWxsID0gKHksIHgsIHN0YXR1cykgPT5cbiAgICAgICAgYDxkaXYgY2xhc3M9XCJncmlkLWNlbGwgY2VsbC0ke3l9LSR7eH0gJHtzdGF0dXN9XCIgZGF0YS15PScke3l9JyBkYXRhLXg9JyR7eH0nPjwvZGl2PmBcblxuICAgIGNvbnN0IHJlbmRlckdyaWQgPSAocGFyZW50LCBnYW1lYm9hcmQsIHR5cGUpID0+IHtcbiAgICAgICAgY29uc3QgYm9hcmQgPSBnYW1lYm9hcmQuZ2V0Qm9hcmQoKVxuICAgICAgICBjb25zdCB7IGxlbmd0aCB9ID0gYm9hcmRcbiAgICAgICAgbGV0IGdyaWQgPSAnJ1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHN0YXR1cyA9IGJvYXJkW2ldW2pdXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAnJ1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzLnNoaXApIHtcbiAgICAgICAgICAgICAgICAgICAgLyogaWYgKHR5cGUgPT09ICdodW1hbicpIHsgKi9cbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gc3RhdHVzLnNoaXAuaWRcbiAgICAgICAgICAgICAgICAgICAgLyogfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICcnXG4gICAgICAgICAgICAgICAgICAgIH0gKi9cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZ3JpZCArPSByZW5kZXJDZWxsKGksIGosIHN0YXR1cylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgZ3JpZClcbiAgICB9XG5cbiAgICByZXR1cm4geyByZW5kZXJHcmlkIH1cbn0pKClcbmV4cG9ydCBkZWZhdWx0IGdhbWVib2FyZFZpZXdcbiIsImltcG9ydCBwbGF5ZXIgZnJvbSAnLi9wbGF5ZXJGYWN0b3J5J1xuaW1wb3J0IGdhbWVib2FyZEZhY3RvcnkgZnJvbSAnLi9nYW1lYm9hcmRGYWN0b3J5J1xuaW1wb3J0IHNoaXBGYWN0b3J5IGZyb20gJy4vc2hpcEZhY3RvcnknXG5pbXBvcnQgZ2FtZWJvYXJkVmlldyBmcm9tICcuL2RvbSdcblxuY29uc3QgcDFHcmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdyaWQtcDEnKVxuY29uc3QgcDJHcmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdyaWQtcDInKVxuXG5jb25zdCBnYW1lID0gKCkgPT4ge1xuICAgIC8vIGNyZWF0ZSBwbGF5ZXJzXG4gICAgY29uc3QgcDEgPSBwbGF5ZXIoJ2h1bWFuJylcbiAgICBjb25zdCBwMiA9IHBsYXllcignY29tcHV0ZXInKVxuXG4gICAgLy8gY3JlYXRlIGJvYXJkc1xuICAgIGNvbnN0IHAxQm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KClcbiAgICBjb25zdCBwMkJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpXG5cbiAgICAvLyBwcmVkZXRlcm1pbmVkIGNvb3JkaW5hdGVzXG4gICAgY29uc3QgY2FycmllciA9IHNoaXBGYWN0b3J5KCdjYXJyaWVyJylcbiAgICBwMUJvYXJkLnBsYWNlU2hpcChjYXJyaWVyLCAwLCAwKVxuICAgIGNvbnN0IGJhdHRsZXNoaXAgPSBzaGlwRmFjdG9yeSgnYmF0dGxlc2hpcCcpXG4gICAgcDJCb2FyZC5wbGFjZVNoaXAoYmF0dGxlc2hpcCwgMCwgMClcblxuICAgIGNvbnN0IHJlbmRlckdyaWRzID0gKCkgPT4ge1xuICAgICAgICBnYW1lYm9hcmRWaWV3LnJlbmRlckdyaWQocDFHcmlkLCBwMUJvYXJkLCBwMS5nZXRUeXBlKCkpXG4gICAgICAgIGdhbWVib2FyZFZpZXcucmVuZGVyR3JpZChwMkdyaWQsIHAyQm9hcmQsIHAyLmdldFR5cGUoKSlcbiAgICB9XG4gICAgcmV0dXJuIHsgcmVuZGVyR3JpZHMgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBnYW1lXG4iLCJpbXBvcnQgZ2FtZSBmcm9tICcuL2dhbWUnXG5cbmdhbWUoKS5yZW5kZXJHcmlkcygpXG4iXSwibmFtZXMiOlsic2hpcHMiLCJyYW5kb20iLCJzaXplIiwiTWF0aCIsImZsb29yIiwicmFuZG9tQ29vcmRpbmF0ZXMiLCJib2FyZCIsIkFycmF5IiwiZmlsbCIsIm1hcCIsInBsYWNlZFNoaXBzIiwiYWRqdXN0Q29vcmRpbmF0ZXMiLCJ5MCIsIngwIiwiaSIsImRpcmVjdGlvbiIsIngiLCJ5IiwicGxhY2VTaGlwIiwic2hpcCIsImdldERpcmVjdGlvbiIsInZhbGlkIiwibGVuZ3RoIiwiY2VsbHMiLCJwdXNoIiwiZXZlcnkiLCJjZWxsIiwiY2hlY2tWYWxpZCIsImluZGV4IiwiYXV0b1BsYWNlIiwiY2hhbmdlRGlyZWN0aW9uIiwiZ2V0Qm9hcmQiLCJhcmVBbGxTaGlwc1BsYWNlZCIsInJlY2VpdmVBdHRhY2siLCJoaXQiLCJhcmVBbGxTaGlwc1N1bmsiLCJpc1N1bmsiLCJyZXNldCIsImF1dG9QbGFjZUZsZWV0IiwiZmxlZXQiLCJzaGlwTGVuZ3RocyIsImNhcnJpZXIiLCJiYXR0bGVzaGlwIiwiY3J1aXNlciIsInN1Ym1hcmluZSIsImRlc3Ryb3llciIsInR5cGUiLCJpZCIsImhpdHMiLCJnZXRIaXRzIiwiaCIsImNyZWF0ZUZsZWV0IiwidHlwZXMiLCJmb3JFYWNoIiwiYXV0b0F0dGFjayIsImh1bWFuQm9hcmQiLCJnZXRUeXBlIiwiZ2V0RmxlZXQiLCJhdHRhY2siLCJjb21wdXRlckJvYXJkIiwicmVzZXRGbGVldCIsInJlbmRlckNlbGwiLCJzdGF0dXMiLCJyZW5kZXJHcmlkIiwicGFyZW50IiwiZ2FtZWJvYXJkIiwiZ3JpZCIsImoiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJwMUdyaWQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwMkdyaWQiLCJwMSIsInAyIiwicDFCb2FyZCIsInAyQm9hcmQiLCJyZW5kZXJHcmlkcyJdLCJzb3VyY2VSb290IjoiIn0=