(()=>{"use strict";const e=["carrier","battleship","cruiser","submarine","destroyer"],t=e=>Math.floor(Math.random()*e),r=(e=10)=>[t(e),t(e)],n=()=>{let t=Array(10).fill(null).map((()=>Array(10).fill(null))),n=[];const l=(e,t,r,n)=>{let l=t+r,i=e;return"vertical"===n&&(l=t,i=e+r),[i,l]},i=(e,r,i)=>{const a=e.getDirection(),c=((e,r,n,i)=>{const a=[];for(let c=0;c<e;c++){const[e,o]=l(n,i,c,r);if(!(e<10&&o<10))return!1;a.push(t[e][o])}return a.every((e=>null===e))})(e.length,a,r,i);if(c){for(let n=0;n<e.length;n++){const[c,o]=l(r,i,n,a);t[c][o]={ship:e,index:n}}return n.push(e),c}return c},a=e=>{const[t,n]=r();Math.random()>.5&&e.changeDirection(),i(e,t,n)||a(e)};return{getBoard:()=>t,areAllShipsPlaced:()=>n.length===e.length,placeShip:i,receiveAttack:(e,r)=>(null===t[e][r]?t[e][r]="miss":t[e][r].ship&&(t[e][r].ship.hit(t[e][r].index),t[e][r]="hit"),t[e][r]),areAllShipsSunk:()=>n.every((e=>e.isSunk())),reset:()=>{t=Array(10).fill(null).map((()=>Array(10).fill(null))),n=[]},autoPlaceFleet:e=>{for(const t in e)a(e[t])}}},l={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2},i=e=>{const t={};return e.forEach((e=>t[e]=(e=>{const t=e,r=l[e];let n="horizontal";const i=Array(r).fill(null);return{id:t,length:r,getDirection:()=>n,changeDirection:()=>{n="horizontal"===n?"vertical":"horizontal"},hit:e=>i[e]="hit",getHits:()=>i,isSunk:()=>i.every((e=>"hit"===e))}})(e))),t},a=t=>{let n=i(e);const l=e=>{const[t,n]=r(),i=e.getBoard()[t][n];"miss"===i||"hit"===i?l(e):e.receiveAttack(t,n)};return{getType:()=>t,getFleet:()=>n,attack:(e,t,r)=>r.receiveAttack(e,t),autoAttack:l,resetFleet:()=>n=i(e)}},c=document.querySelector(".winner-container"),o=document.querySelector(".winner-info"),s=document.querySelector(".buttons-container"),u=document.querySelector(".auto-place"),d=(()=>{const e=(e,t,r)=>`<div class="grid-cell cell-${e}-${t} ${r}" data-y='${e}' data-x='${t}'></div>`;return{renderGrid:(t,r,n)=>{(e=>{e.textContent=""})(t);const l=r.getBoard(),{length:i}=l;let a="";for(let t=0;t<i;t++)for(let r=0;r<i;r++){let i=l[t][r];null===i?i="":i.ship&&(i="human"===n?i.ship.id:""),a+=e(t,r,i)}t.insertAdjacentHTML("afterbegin",a)},renderWinner:e=>{c.classList.add("active"),o.textContent=e},startGame:()=>{s.classList.add("hide"),u.setAttribute("disabled","")}}})(),h=document.querySelector(".grid-p1"),p=document.querySelector(".grid-p2"),g=()=>{const e=a("human"),t=a("computer"),r=n(),l=n(),i=()=>{d.renderGrid(h,r,e.getType()),d.renderGrid(p,l,t.getType())},c=n=>{const a=n.target;if(a.classList.contains("grid-cell")){const{y:n}=a.dataset,{x:o}=a.dataset,s=l.getBoard()[n][o];if("miss"!==s&&"hit"!==s&&(e.attack(n,o,l),t.autoAttack(r),i()),r.areAllShipsSunk()||l.areAllShipsSunk()){let e="";r.areAllShipsSunk()?e="Computer Fleet wins!":l.areAllShipsSunk()&&(e="Human Fleet wins!"),p.removeEventListener("click",c),d.renderWinner(e)}}};return{renderGrids:i,autoPlace:()=>{r.reset(),r.autoPlaceFleet(e.getFleet()),l.autoPlaceFleet(t.getFleet()),i(),p.addEventListener("click",(e=>{d.startGame(),c(e)}))}}},m=document.querySelector(".auto-place"),y=document.querySelector(".play-again"),S=document.querySelector(".my-link");g().renderGrids(),m.addEventListener("click",(()=>{g().autoPlace()})),y.addEventListener("click",(()=>{S.click()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDRlUsRUFBUXJELG9CQUNmMkMsRUFBUyxxQkFFYk0sRUFBT1csb0JBQW9CLFFBQVNyQyxHQUNwQyxlQUEyQm9CLE1BbUJ2QyxNQUFPLENBQUVXLFlBQUFBLEVBQWE1RCxVQVJKLEtBQ2QwRCxFQUFRbEQsUUFDUmtELEVBQVFqRCxlQUFlK0MsRUFBRzVCLFlBQzFCK0IsRUFBUWxELGVBQWVnRCxFQUFHN0IsWUFDMUJnQyxJQVZBTCxFQUFPWSxpQkFBaUIsU0FBVU4sSUFDOUIsY0FDQWhDLEVBQU9nQyxTQzdDYixFQUFlNUIsU0FBU0MsY0FBYyxlQUN0Q2tDLEVBQWVuQyxTQUFTQyxjQUFjLGVBQ3RDLEVBQU9ELFNBQVNDLGNBQWMsWUFFcEMsSUFBTzBCLGNBRVAsRUFBYU8saUJBQWlCLFNBQVMsS0FDbkMsSUFBT25FLGVBR1hvRSxFQUFhRCxpQkFBaUIsU0FBUyxLQUNuQyxFQUFLRSxZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9nYW1lYm9hcmRGYWN0b3J5LmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMvc2hpcEZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9wbGF5ZXJGYWN0b3J5LmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9kb20uanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9nYW1lLmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2hpcHMgPSBbXG4gICAgJ2NhcnJpZXInLFxuICAgICdiYXR0bGVzaGlwJyxcbiAgICAnY3J1aXNlcicsXG4gICAgJ3N1Ym1hcmluZScsXG4gICAgJ2Rlc3Ryb3llcicsXG5dXG5cbmNvbnN0IHJhbmRvbSA9IChzaXplKSA9PiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaXplKSAvLyAwIHRvIDEwIGludFxuZXhwb3J0IGNvbnN0IHJhbmRvbUNvb3JkaW5hdGVzID0gKHNpemUgPSAxMCkgPT4gW3JhbmRvbShzaXplKSwgcmFuZG9tKHNpemUpXVxuXG5jb25zdCBnYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICAgIC8vIGNyZWF0ZSAxMHgxMCBncmlkIHcvIG11bHRpZGltZW5zaW9uYWwgYXJyYXlcbiAgICBsZXQgYm9hcmQgPSBBcnJheSgxMClcbiAgICAgICAgLmZpbGwobnVsbClcbiAgICAgICAgLm1hcCgoKSA9PiBBcnJheSgxMCkuZmlsbChudWxsKSlcbiAgICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IGJvYXJkXG5cbiAgICBsZXQgcGxhY2VkU2hpcHMgPSBbXVxuICAgIGNvbnN0IGFyZUFsbFNoaXBzUGxhY2VkID0gKCkgPT4gcGxhY2VkU2hpcHMubGVuZ3RoID09PSBzaGlwcy5sZW5ndGhcblxuICAgIC8vIGJhc2VkIG9uIHRoZSB3aGljaCBheGlzIGlzIGl0LCBmcm9tIHdoZXJlIChjb29yZGluYXRlcykgdG8gd2hlcmUgKGxlbmd0aCAvIGkpIHRvIGJ1aWxkIGl0XG4gICAgY29uc3QgYWRqdXN0Q29vcmRpbmF0ZXMgPSAoeTAsIHgwLCBpLCBkaXJlY3Rpb24pID0+IHtcbiAgICAgICAgLy8gZGVmYXVsdCAtIGhvcml6b250YWxcbiAgICAgICAgbGV0IHggPSB4MCArIGlcbiAgICAgICAgbGV0IHkgPSB5MFxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndmVydGljYWwnKSB7XG4gICAgICAgICAgICB4ID0geDBcbiAgICAgICAgICAgIHkgPSB5MCArIGlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW3ksIHhdXG4gICAgfVxuXG4gICAgY29uc3QgY2hlY2tWYWxpZCA9IChsZW5ndGgsIGRpcmVjdGlvbiwgeTAsIHgwKSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGxzID0gW11cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgW3ksIHhdID0gYWRqdXN0Q29vcmRpbmF0ZXMoeTAsIHgwLCBpLCBkaXJlY3Rpb24pXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBvdXQgb2YgYm91bmRzXG4gICAgICAgICAgICBpZiAoeSA8IDEwICYmIHggPCAxMCkge1xuICAgICAgICAgICAgICAgIGNlbGxzLnB1c2goYm9hcmRbeV1beF0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjZWxscy5ldmVyeSgoY2VsbCkgPT4gY2VsbCA9PT0gbnVsbClcbiAgICB9XG5cbiAgICAvLyBwbGFjZSBzaGlwIGF0IGNvb3JkaW5hdGVzICh5LCB4KVxuICAgIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCB5MCwgeDApID0+IHtcbiAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gc2hpcC5nZXREaXJlY3Rpb24oKVxuICAgICAgICBjb25zdCB2YWxpZCA9IGNoZWNrVmFsaWQoc2hpcC5sZW5ndGgsIGRpcmVjdGlvbiwgeTAsIHgwKVxuICAgICAgICBpZiAodmFsaWQpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IFt5LCB4XSA9IGFkanVzdENvb3JkaW5hdGVzKHkwLCB4MCwgaSwgZGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgIGJvYXJkW3ldW3hdID0geyBzaGlwLCBpbmRleDogaSB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwbGFjZWRTaGlwcy5wdXNoKHNoaXApXG4gICAgICAgICAgICByZXR1cm4gdmFsaWRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsaWRcbiAgICB9XG5cbiAgICBjb25zdCByZWNlaXZlQXR0YWNrID0gKHksIHgpID0+IHtcbiAgICAgICAgaWYgKGJvYXJkW3ldW3hdID09PSBudWxsKSB7XG4gICAgICAgICAgICBib2FyZFt5XVt4XSA9ICdtaXNzJyAvLyByZWNvcmRzIG1pc3NlZCBzaG90XG4gICAgICAgIH0gZWxzZSBpZiAoYm9hcmRbeV1beF0uc2hpcCkge1xuICAgICAgICAgICAgYm9hcmRbeV1beF0uc2hpcC5oaXQoYm9hcmRbeV1beF0uaW5kZXgpXG4gICAgICAgICAgICBib2FyZFt5XVt4XSA9ICdoaXQnIC8vIHJlY29yZHMgaGl0XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJvYXJkW3ldW3hdXG4gICAgfVxuXG4gICAgY29uc3QgYXJlQWxsU2hpcHNTdW5rID0gKCkgPT4gcGxhY2VkU2hpcHMuZXZlcnkoKHNoaXApID0+IHNoaXAuaXNTdW5rKCkpXG5cbiAgICBjb25zdCByZXNldCA9ICgpID0+IHtcbiAgICAgICAgYm9hcmQgPSBBcnJheSgxMClcbiAgICAgICAgICAgIC5maWxsKG51bGwpXG4gICAgICAgICAgICAubWFwKCgpID0+IEFycmF5KDEwKS5maWxsKG51bGwpKVxuICAgICAgICBwbGFjZWRTaGlwcyA9IFtdXG4gICAgfVxuXG4gICAgY29uc3QgYXV0b1BsYWNlID0gKHNoaXApID0+IHtcbiAgICAgICAgY29uc3QgW3ksIHhdID0gcmFuZG9tQ29vcmRpbmF0ZXMoKVxuICAgICAgICBjb25zdCBjaGFuZ2VPcmllbnQgPSBNYXRoLnJhbmRvbSgpID4gMC41XG4gICAgICAgIGlmIChjaGFuZ2VPcmllbnQpIHNoaXAuY2hhbmdlRGlyZWN0aW9uKClcbiAgICAgICAgY29uc3QgcGxhY2VkID0gcGxhY2VTaGlwKHNoaXAsIHksIHgpXG4gICAgICAgIGlmICghcGxhY2VkKSBhdXRvUGxhY2Uoc2hpcClcbiAgICB9XG5cbiAgICBjb25zdCBhdXRvUGxhY2VGbGVldCA9IChmbGVldCkgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IHNoaXAgaW4gZmxlZXQpIHtcbiAgICAgICAgICAgIGF1dG9QbGFjZShmbGVldFtzaGlwXSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdldEJvYXJkLFxuICAgICAgICBhcmVBbGxTaGlwc1BsYWNlZCxcbiAgICAgICAgcGxhY2VTaGlwLFxuICAgICAgICByZWNlaXZlQXR0YWNrLFxuICAgICAgICBhcmVBbGxTaGlwc1N1bmssXG4gICAgICAgIHJlc2V0LFxuICAgICAgICBhdXRvUGxhY2VGbGVldCxcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWVib2FyZEZhY3RvcnlcbiIsImNvbnN0IHNoaXBMZW5ndGhzID0ge1xuICAgIGNhcnJpZXI6IDUsXG4gICAgYmF0dGxlc2hpcDogNCxcbiAgICBjcnVpc2VyOiAzLFxuICAgIHN1Ym1hcmluZTogMyxcbiAgICBkZXN0cm95ZXI6IDIsXG59XG5cbmNvbnN0IHNoaXBGYWN0b3J5ID0gKHR5cGUpID0+IHtcbiAgICAvLyBQcm9wZXJ0aWVzXG4gICAgY29uc3QgaWQgPSB0eXBlXG4gICAgY29uc3QgbGVuZ3RoID0gc2hpcExlbmd0aHNbdHlwZV1cbiAgICBsZXQgZGlyZWN0aW9uID0gJ2hvcml6b250YWwnXG5cbiAgICBjb25zdCBnZXREaXJlY3Rpb24gPSAoKSA9PiBkaXJlY3Rpb25cbiAgICBjb25zdCBjaGFuZ2VEaXJlY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgIGRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnXG4gICAgICAgICAgICA/IChkaXJlY3Rpb24gPSAndmVydGljYWwnKVxuICAgICAgICAgICAgOiAoZGlyZWN0aW9uID0gJ2hvcml6b250YWwnKVxuICAgIH1cblxuICAgIC8vIEhpdCBmdW5jdGlvblxuICAgIGNvbnN0IGhpdHMgPSBBcnJheShsZW5ndGgpLmZpbGwobnVsbClcbiAgICBjb25zdCBoaXQgPSAoaSkgPT4gKGhpdHNbaV0gPSAnaGl0JylcbiAgICBjb25zdCBnZXRIaXRzID0gKCkgPT4gaGl0c1xuXG4gICAgLy8gU3VuayBmdW5jdGlvblxuICAgIGNvbnN0IGlzU3VuayA9ICgpID0+IGhpdHMuZXZlcnkoKGgpID0+IGggPT09ICdoaXQnKVxuXG4gICAgcmV0dXJuIHsgaWQsIGxlbmd0aCwgZ2V0RGlyZWN0aW9uLCBjaGFuZ2VEaXJlY3Rpb24sIGhpdCwgZ2V0SGl0cywgaXNTdW5rIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgc2hpcEZhY3RvcnlcbiIsImltcG9ydCB7IHNoaXBzLCByYW5kb21Db29yZGluYXRlcyB9IGZyb20gJy4vZ2FtZWJvYXJkRmFjdG9yeSdcbmltcG9ydCBzaGlwRmFjdG9yeSBmcm9tICcuL3NoaXBGYWN0b3J5J1xuXG5jb25zdCBjcmVhdGVGbGVldCA9ICh0eXBlcykgPT4ge1xuICAgIGNvbnN0IGZsZWV0ID0ge31cbiAgICB0eXBlcy5mb3JFYWNoKCh0eXBlKSA9PiAoZmxlZXRbdHlwZV0gPSBzaGlwRmFjdG9yeSh0eXBlKSkpXG4gICAgcmV0dXJuIGZsZWV0XG59XG5cbmNvbnN0IHBsYXllciA9ICh0eXBlKSA9PiB7XG4gICAgbGV0IGZsZWV0ID0gY3JlYXRlRmxlZXQoc2hpcHMpXG5cbiAgICBjb25zdCBnZXRUeXBlID0gKCkgPT4gdHlwZVxuICAgIGNvbnN0IGdldEZsZWV0ID0gKCkgPT4gZmxlZXRcblxuICAgIGNvbnN0IGF0dGFjayA9ICh5LCB4LCBjb21wdXRlckJvYXJkKSA9PiBjb21wdXRlckJvYXJkLnJlY2VpdmVBdHRhY2soeSwgeClcblxuICAgIGNvbnN0IGF1dG9BdHRhY2sgPSAoaHVtYW5Cb2FyZCkgPT4ge1xuICAgICAgICBjb25zdCBbeSwgeF0gPSByYW5kb21Db29yZGluYXRlcygpXG4gICAgICAgIGNvbnN0IGNlbGwgPSBodW1hbkJvYXJkLmdldEJvYXJkKClbeV1beF1cbiAgICAgICAgaWYgKGNlbGwgPT09ICdtaXNzJyB8fCBjZWxsID09PSAnaGl0Jykge1xuICAgICAgICAgICAgYXV0b0F0dGFjayhodW1hbkJvYXJkKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaHVtYW5Cb2FyZC5yZWNlaXZlQXR0YWNrKHksIHgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXNldEZsZWV0ID0gKCkgPT4gKGZsZWV0ID0gY3JlYXRlRmxlZXQoc2hpcHMpKVxuXG4gICAgcmV0dXJuIHsgZ2V0VHlwZSwgZ2V0RmxlZXQsIGF0dGFjaywgYXV0b0F0dGFjaywgcmVzZXRGbGVldCB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHBsYXllclxuIiwiY29uc3Qgd2lubmVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndpbm5lci1jb250YWluZXInKVxuY29uc3Qgd2lubmVySW5mbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW5uZXItaW5mbycpXG5jb25zdCBidXR0b25zQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMtY29udGFpbmVyJylcbmNvbnN0IGF1dG9QbGFjZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdXRvLXBsYWNlJylcblxuY29uc3QgZ2FtZWJvYXJkVmlldyA9ICgoKSA9PiB7XG4gICAgY29uc3QgcmVuZGVyQ2VsbCA9ICh5LCB4LCBzdGF0dXMpID0+XG4gICAgICAgIGA8ZGl2IGNsYXNzPVwiZ3JpZC1jZWxsIGNlbGwtJHt5fS0ke3h9ICR7c3RhdHVzfVwiIGRhdGEteT0nJHt5fScgZGF0YS14PScke3h9Jz48L2Rpdj5gXG5cbiAgICBjb25zdCBjbGVhckdyaWQgPSAocGFyZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGdyaWQgPSBwYXJlbnRcbiAgICAgICAgZ3JpZC50ZXh0Q29udGVudCA9ICcnXG4gICAgfVxuXG4gICAgY29uc3QgcmVuZGVyR3JpZCA9IChwYXJlbnQsIGdhbWVib2FyZCwgdHlwZSkgPT4ge1xuICAgICAgICBjbGVhckdyaWQocGFyZW50KVxuICAgICAgICBjb25zdCBib2FyZCA9IGdhbWVib2FyZC5nZXRCb2FyZCgpXG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBib2FyZFxuICAgICAgICBsZXQgZ3JpZCA9ICcnXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgc3RhdHVzID0gYm9hcmRbaV1bal1cbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICcnXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMuc2hpcCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2h1bWFuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gc3RhdHVzLnNoaXAuaWRcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgc2hpcCBpbiBkZXYgdG9vbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICcnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZ3JpZCArPSByZW5kZXJDZWxsKGksIGosIHN0YXR1cylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmJlZ2luJywgZ3JpZClcbiAgICB9XG5cbiAgICBjb25zdCByZW5kZXJXaW5uZXIgPSAod2lubmVyKSA9PiB7XG4gICAgICAgIHdpbm5lckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxuICAgICAgICB3aW5uZXJJbmZvLnRleHRDb250ZW50ID0gd2lubmVyXG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlIGJ1dHRvbnMgb24gc3RhcnRcbiAgICBjb25zdCBzdGFydEdhbWUgPSAoKSA9PiB7XG4gICAgICAgIGJ1dHRvbnNDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZScpXG4gICAgICAgIGF1dG9QbGFjZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpXG4gICAgfVxuXG4gICAgcmV0dXJuIHsgcmVuZGVyR3JpZCwgcmVuZGVyV2lubmVyLCBzdGFydEdhbWUgfVxufSkoKVxuZXhwb3J0IGRlZmF1bHQgZ2FtZWJvYXJkVmlld1xuIiwiaW1wb3J0IHBsYXllciBmcm9tICcuL3BsYXllckZhY3RvcnknXG5pbXBvcnQgZ2FtZWJvYXJkRmFjdG9yeSBmcm9tICcuL2dhbWVib2FyZEZhY3RvcnknXG5pbXBvcnQgZ2FtZWJvYXJkVmlldyBmcm9tICcuLi9kb20nXG5cbmNvbnN0IHAxR3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLXAxJylcbmNvbnN0IHAyR3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLXAyJylcblxuY29uc3QgZ2FtZSA9ICgpID0+IHtcbiAgICBjb25zdCBwMSA9IHBsYXllcignaHVtYW4nKVxuICAgIGNvbnN0IHAyID0gcGxheWVyKCdjb21wdXRlcicpXG5cbiAgICBjb25zdCBwMUJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpXG4gICAgY29uc3QgcDJCb2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKVxuXG4gICAgY29uc3QgcmVuZGVyR3JpZHMgPSAoKSA9PiB7XG4gICAgICAgIGdhbWVib2FyZFZpZXcucmVuZGVyR3JpZChwMUdyaWQsIHAxQm9hcmQsIHAxLmdldFR5cGUoKSlcbiAgICAgICAgZ2FtZWJvYXJkVmlldy5yZW5kZXJHcmlkKHAyR3JpZCwgcDJCb2FyZCwgcDIuZ2V0VHlwZSgpKVxuICAgIH1cblxuICAgIGNvbnN0IGF0dGFjayA9IChlKSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBlLnRhcmdldFxuICAgICAgICBpZiAoY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ2dyaWQtY2VsbCcpKSB7XG4gICAgICAgICAgICBjb25zdCB7IHkgfSA9IGNlbGwuZGF0YXNldFxuICAgICAgICAgICAgY29uc3QgeyB4IH0gPSBjZWxsLmRhdGFzZXRcblxuICAgICAgICAgICAgY29uc3QgYm9hcmRDZWxsID0gcDJCb2FyZC5nZXRCb2FyZCgpW3ldW3hdXG4gICAgICAgICAgICBpZiAoYm9hcmRDZWxsICE9PSAnbWlzcycgJiYgYm9hcmRDZWxsICE9PSAnaGl0Jykge1xuICAgICAgICAgICAgICAgIHAxLmF0dGFjayh5LCB4LCBwMkJvYXJkKVxuICAgICAgICAgICAgICAgIHAyLmF1dG9BdHRhY2socDFCb2FyZClcblxuICAgICAgICAgICAgICAgIHJlbmRlckdyaWRzKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwMUJvYXJkLmFyZUFsbFNoaXBzU3VuaygpIHx8IHAyQm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgd2lubmVyID0gJydcbiAgICAgICAgICAgICAgICBpZiAocDFCb2FyZC5hcmVBbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5uZXIgPSAnQ29tcHV0ZXIgRmxlZXQgd2lucyEnXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwMkJvYXJkLmFyZUFsbFNoaXBzU3VuaygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbm5lciA9ICdIdW1hbiBGbGVldCB3aW5zISdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcDJHcmlkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXR0YWNrKVxuICAgICAgICAgICAgICAgIGdhbWVib2FyZFZpZXcucmVuZGVyV2lubmVyKHdpbm5lcilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBhZGRBdHRhY2tFdmVudExpc3RlbmVyID0gKCkgPT4ge1xuICAgICAgICBwMkdyaWQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZ2FtZWJvYXJkVmlldy5zdGFydEdhbWUoKVxuICAgICAgICAgICAgYXR0YWNrKGUpXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgYXV0b1BsYWNlID0gKCkgPT4ge1xuICAgICAgICBwMUJvYXJkLnJlc2V0KClcbiAgICAgICAgcDFCb2FyZC5hdXRvUGxhY2VGbGVldChwMS5nZXRGbGVldCgpKVxuICAgICAgICBwMkJvYXJkLmF1dG9QbGFjZUZsZWV0KHAyLmdldEZsZWV0KCkpXG4gICAgICAgIHJlbmRlckdyaWRzKClcbiAgICAgICAgYWRkQXR0YWNrRXZlbnRMaXN0ZW5lcigpXG4gICAgfVxuXG4gICAgcmV0dXJuIHsgcmVuZGVyR3JpZHMsIGF1dG9QbGFjZSB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWVcbiIsImltcG9ydCBnYW1lIGZyb20gJy4vZmFjdG9yaWVzL2dhbWUnXG5cbmNvbnN0IGF1dG9QbGFjZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdXRvLXBsYWNlJylcbmNvbnN0IHBsYXlBZ2FpbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5LWFnYWluJylcbmNvbnN0IGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktbGluaycpXG5cbmdhbWUoKS5yZW5kZXJHcmlkcygpXG5cbmF1dG9QbGFjZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBnYW1lKCkuYXV0b1BsYWNlKClcbn0pXG5cbnBsYXlBZ2FpbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBsaW5rLmNsaWNrKClcbn0pXG4iXSwibmFtZXMiOlsic2hpcHMiLCJyYW5kb20iLCJzaXplIiwiTWF0aCIsImZsb29yIiwicmFuZG9tQ29vcmRpbmF0ZXMiLCJib2FyZCIsIkFycmF5IiwiZmlsbCIsIm1hcCIsInBsYWNlZFNoaXBzIiwiYWRqdXN0Q29vcmRpbmF0ZXMiLCJ5MCIsIngwIiwiaSIsImRpcmVjdGlvbiIsIngiLCJ5IiwicGxhY2VTaGlwIiwic2hpcCIsImdldERpcmVjdGlvbiIsInZhbGlkIiwibGVuZ3RoIiwiY2VsbHMiLCJwdXNoIiwiZXZlcnkiLCJjZWxsIiwiY2hlY2tWYWxpZCIsImluZGV4IiwiYXV0b1BsYWNlIiwiY2hhbmdlRGlyZWN0aW9uIiwiZ2V0Qm9hcmQiLCJhcmVBbGxTaGlwc1BsYWNlZCIsInJlY2VpdmVBdHRhY2siLCJoaXQiLCJhcmVBbGxTaGlwc1N1bmsiLCJpc1N1bmsiLCJyZXNldCIsImF1dG9QbGFjZUZsZWV0IiwiZmxlZXQiLCJzaGlwTGVuZ3RocyIsImNhcnJpZXIiLCJiYXR0bGVzaGlwIiwiY3J1aXNlciIsInN1Ym1hcmluZSIsImRlc3Ryb3llciIsImNyZWF0ZUZsZWV0IiwidHlwZXMiLCJmb3JFYWNoIiwidHlwZSIsImlkIiwiaGl0cyIsImdldEhpdHMiLCJoIiwiYXV0b0F0dGFjayIsImh1bWFuQm9hcmQiLCJnZXRUeXBlIiwiZ2V0RmxlZXQiLCJhdHRhY2siLCJjb21wdXRlckJvYXJkIiwicmVzZXRGbGVldCIsIndpbm5lckNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIndpbm5lckluZm8iLCJidXR0b25zQ29udGFpbmVyIiwiYXV0b1BsYWNlQnRuIiwicmVuZGVyQ2VsbCIsInN0YXR1cyIsInJlbmRlckdyaWQiLCJwYXJlbnQiLCJnYW1lYm9hcmQiLCJ0ZXh0Q29udGVudCIsImNsZWFyR3JpZCIsImdyaWQiLCJqIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwicmVuZGVyV2lubmVyIiwid2lubmVyIiwiY2xhc3NMaXN0IiwiYWRkIiwic3RhcnRHYW1lIiwic2V0QXR0cmlidXRlIiwicDFHcmlkIiwicDJHcmlkIiwicDEiLCJwMiIsInAxQm9hcmQiLCJwMkJvYXJkIiwicmVuZGVyR3JpZHMiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJkYXRhc2V0IiwiYm9hcmRDZWxsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJwbGF5QWdhaW5CdG4iLCJjbGljayJdLCJzb3VyY2VSb290IjoiIn0=