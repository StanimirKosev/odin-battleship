(()=>{"use strict";const e=["carrier","battleship","cruiser","submarine","destroyer"],t=e=>Math.floor(Math.random()*e),r=(e=10)=>[t(e),t(e)],n=()=>{let t=Array(10).fill(null).map((()=>Array(10).fill(null))),n=[];const i=(e,t,r,n)=>{let i=t+r,l=e;return"vertical"===n&&(i=t,l=e+r),[l,i]},l=(e,r,l)=>{const a=e.getDirection(),c=((e,r,n,l)=>{const a=[];for(let c=0;c<e;c++){const[e,s]=i(n,l,c,r);if(!(e<10&&s<10))return!1;a.push(t[e][s])}return a.every((e=>null===e))})(e.length,a,r,l);if(c){for(let n=0;n<e.length;n++){const[c,s]=i(r,l,n,a);t[c][s]={ship:e,index:n}}return n.push(e),c}return c},a=e=>{const[t,n]=r();Math.random()>.5&&e.changeDirection(),l(e,t,n)||a(e)};return{getBoard:()=>t,areAllShipsPlaced:()=>n.length===e.length,placeShip:l,receiveAttack:(e,r)=>(null===t[e][r]?t[e][r]="miss":t[e][r].ship&&(t[e][r].ship.hit(t[e][r].index),t[e][r]="hit"),t[e][r]),areAllShipsSunk:()=>n.every((e=>e.isSunk())),reset:()=>{t=Array(10).fill(null).map((()=>Array(10).fill(null))),n=[]},autoPlaceFleet:e=>{for(const t in e)a(e[t])}}},i={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2},l=e=>{const t=e,r=i[e];let n="horizontal";const l=Array(r).fill(null);return{id:t,length:r,getDirection:()=>n,changeDirection:()=>{n="horizontal"===n?"vertical":"horizontal"},hit:e=>l[e]="hit",getHits:()=>l,isSunk:()=>l.every((e=>"hit"===e))}},a=e=>{const t={};return e.forEach((e=>t[e]=l(e))),t},c=t=>{let n=a(e);const i=e=>{const[t,n]=r(),l=e.getBoard()[t][n];"miss"===l||"hit"===l?i(e):e.receiveAttack(t,n)};return{getType:()=>t,getFleet:()=>n,attack:(e,t,r)=>r.receiveAttack(e,t),autoAttack:i,resetFleet:()=>n=a(e)}},s=document.querySelector(".winner-container"),o=document.querySelector(".winner-info"),u=(()=>{const e=(e,t,r)=>`<div class="grid-cell cell-${e}-${t} ${r}" data-y='${e}' data-x='${t}'></div>`;return{renderGrid:(t,r,n)=>{(e=>{e.textContent=""})(t);const i=r.getBoard(),{length:l}=i;let a="";for(let t=0;t<l;t++)for(let r=0;r<l;r++){let n=i[t][r];null===n?n="":n.ship&&(n=n.ship.id),a+=e(t,r,n)}t.insertAdjacentHTML("afterbegin",a)},renderWinner:e=>{s.classList.toggle("active"),o.textContent=e}}})(),d=document.querySelector(".grid-p1"),h=document.querySelector(".grid-p2"),p=()=>{const e=c("human"),t=c("computer"),r=n(),i=n(),a=l("carrier");r.placeShip(a,0,0);const s=l("battleship");i.placeShip(s,0,0);const o=()=>{u.renderGrid(d,r,e.getType()),u.renderGrid(h,i,t.getType())},p=n=>{const l=n.target;if(l.classList.contains("grid-cell")){const{y:n}=l.dataset,{x:a}=l.dataset,c=i.getBoard()[n][a];if("miss"!==c&&"hit"!==c&&(e.attack(n,a,i),t.autoAttack(r),o()),r.areAllShipsSunk()||i.areAllShipsSunk()){let e="";r.areAllShipsSunk()?e="Computer wins!":i.areAllShipsSunk()&&(e="Human wins!"),h.removeEventListener("click",p),u.renderWinner(e)}}};return{renderGrids:o,addAttackEventListener:()=>{h.addEventListener("click",p)}}};p().renderGrids(),p().addAttackEventListener()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eUMsRUFBUyxlQUViSSxFQUFPVyxvQkFBb0IsUUFBU2pDLEdBQ3BDLGVBQTJCa0IsTUFTdkMsTUFBTyxDQUFFUyxZQUFBQSxFQUFhTyx1QkFKUyxLQUMzQlosRUFBT2EsaUJBQWlCLFFBQVNuQyxNQ3JEekMsSUFBTzJCLGNBRVAsSUFBT08sMEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkRmFjdG9yeS5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvc2hpcEZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL3BsYXllckZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNoaXBzID0gW1xuICAgICdjYXJyaWVyJyxcbiAgICAnYmF0dGxlc2hpcCcsXG4gICAgJ2NydWlzZXInLFxuICAgICdzdWJtYXJpbmUnLFxuICAgICdkZXN0cm95ZXInLFxuXVxuXG5jb25zdCByYW5kb20gPSAoc2l6ZSkgPT4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc2l6ZSkgLy8gMCB0byAxMCBpbnRcbmV4cG9ydCBjb25zdCByYW5kb21Db29yZGluYXRlcyA9IChzaXplID0gMTApID0+IFtyYW5kb20oc2l6ZSksIHJhbmRvbShzaXplKV1cblxuY29uc3QgZ2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgICAvLyBjcmVhdGUgMTB4MTAgZ3JpZCB3LyBtdWx0aWRpbWVuc2lvbmFsIGFycmF5XG4gICAgbGV0IGJvYXJkID0gQXJyYXkoMTApXG4gICAgICAgIC5maWxsKG51bGwpXG4gICAgICAgIC5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwobnVsbCkpXG4gICAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiBib2FyZFxuXG4gICAgbGV0IHBsYWNlZFNoaXBzID0gW11cbiAgICBjb25zdCBhcmVBbGxTaGlwc1BsYWNlZCA9ICgpID0+IHBsYWNlZFNoaXBzLmxlbmd0aCA9PT0gc2hpcHMubGVuZ3RoXG5cbiAgICAvLyBiYXNlZCBvbiB0aGUgd2hpY2ggYXhpcyBpcyBpdCwgZnJvbSB3aGVyZSAoY29vcmRpbmF0ZXMpIHRvIHdoZXJlIChsZW5ndGggLyBpKSB0byBidWlsZCBpdFxuICAgIGNvbnN0IGFkanVzdENvb3JkaW5hdGVzID0gKHkwLCB4MCwgaSwgZGlyZWN0aW9uKSA9PiB7XG4gICAgICAgIC8vIGRlZmF1bHQgLSBob3Jpem9udGFsXG4gICAgICAgIGxldCB4ID0geDAgKyBpXG4gICAgICAgIGxldCB5ID0geTBcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJykge1xuICAgICAgICAgICAgeCA9IHgwXG4gICAgICAgICAgICB5ID0geTAgKyBpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFt5LCB4XVxuICAgIH1cblxuICAgIGNvbnN0IGNoZWNrVmFsaWQgPSAobGVuZ3RoLCBkaXJlY3Rpb24sIHkwLCB4MCkgPT4ge1xuICAgICAgICBjb25zdCBjZWxscyA9IFtdXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IFt5LCB4XSA9IGFkanVzdENvb3JkaW5hdGVzKHkwLCB4MCwgaSwgZGlyZWN0aW9uKVxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgb3V0IG9mIGJvdW5kc1xuICAgICAgICAgICAgaWYgKHkgPCAxMCAmJiB4IDwgMTApIHtcbiAgICAgICAgICAgICAgICBjZWxscy5wdXNoKGJvYXJkW3ldW3hdKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2VsbHMuZXZlcnkoKGNlbGwpID0+IGNlbGwgPT09IG51bGwpXG4gICAgfVxuXG4gICAgLy8gcGxhY2Ugc2hpcCBhdCBjb29yZGluYXRlcyAoeSwgeClcbiAgICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcCwgeTAsIHgwKSA9PiB7XG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHNoaXAuZ2V0RGlyZWN0aW9uKClcbiAgICAgICAgY29uc3QgdmFsaWQgPSBjaGVja1ZhbGlkKHNoaXAubGVuZ3RoLCBkaXJlY3Rpb24sIHkwLCB4MClcbiAgICAgICAgaWYgKHZhbGlkKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBbeSwgeF0gPSBhZGp1c3RDb29yZGluYXRlcyh5MCwgeDAsIGksIGRpcmVjdGlvbilcbiAgICAgICAgICAgICAgICBib2FyZFt5XVt4XSA9IHsgc2hpcCwgaW5kZXg6IGkgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGxhY2VkU2hpcHMucHVzaChzaGlwKVxuICAgICAgICAgICAgcmV0dXJuIHZhbGlkXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbGlkXG4gICAgfVxuXG4gICAgY29uc3QgcmVjZWl2ZUF0dGFjayA9ICh5LCB4KSA9PiB7XG4gICAgICAgIGlmIChib2FyZFt5XVt4XSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgYm9hcmRbeV1beF0gPSAnbWlzcycgLy8gcmVjb3JkcyBtaXNzZWQgc2hvdFxuICAgICAgICB9IGVsc2UgaWYgKGJvYXJkW3ldW3hdLnNoaXApIHtcbiAgICAgICAgICAgIGJvYXJkW3ldW3hdLnNoaXAuaGl0KGJvYXJkW3ldW3hdLmluZGV4KVxuICAgICAgICAgICAgYm9hcmRbeV1beF0gPSAnaGl0JyAvLyByZWNvcmRzIGhpdFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBib2FyZFt5XVt4XVxuICAgIH1cblxuICAgIGNvbnN0IGFyZUFsbFNoaXBzU3VuayA9ICgpID0+IHBsYWNlZFNoaXBzLmV2ZXJ5KChzaGlwKSA9PiBzaGlwLmlzU3VuaygpKVxuXG4gICAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgICAgIGJvYXJkID0gQXJyYXkoMTApXG4gICAgICAgICAgICAuZmlsbChudWxsKVxuICAgICAgICAgICAgLm1hcCgoKSA9PiBBcnJheSgxMCkuZmlsbChudWxsKSlcbiAgICAgICAgcGxhY2VkU2hpcHMgPSBbXVxuICAgIH1cblxuICAgIGNvbnN0IGF1dG9QbGFjZSA9IChzaGlwKSA9PiB7XG4gICAgICAgIGNvbnN0IFt5LCB4XSA9IHJhbmRvbUNvb3JkaW5hdGVzKClcbiAgICAgICAgY29uc3QgY2hhbmdlT3JpZW50ID0gTWF0aC5yYW5kb20oKSA+IDAuNVxuICAgICAgICBpZiAoY2hhbmdlT3JpZW50KSBzaGlwLmNoYW5nZURpcmVjdGlvbigpXG4gICAgICAgIGNvbnN0IHBsYWNlZCA9IHBsYWNlU2hpcChzaGlwLCB5LCB4KVxuICAgICAgICBpZiAoIXBsYWNlZCkgYXV0b1BsYWNlKHNoaXApXG4gICAgfVxuXG4gICAgY29uc3QgYXV0b1BsYWNlRmxlZXQgPSAoZmxlZXQpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBzaGlwIGluIGZsZWV0KSB7XG4gICAgICAgICAgICBhdXRvUGxhY2UoZmxlZXRbc2hpcF0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXRCb2FyZCxcbiAgICAgICAgYXJlQWxsU2hpcHNQbGFjZWQsXG4gICAgICAgIHBsYWNlU2hpcCxcbiAgICAgICAgcmVjZWl2ZUF0dGFjayxcbiAgICAgICAgYXJlQWxsU2hpcHNTdW5rLFxuICAgICAgICByZXNldCxcbiAgICAgICAgYXV0b1BsYWNlRmxlZXQsXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBnYW1lYm9hcmRGYWN0b3J5XG4iLCJjb25zdCBzaGlwTGVuZ3RocyA9IHtcbiAgICBjYXJyaWVyOiA1LFxuICAgIGJhdHRsZXNoaXA6IDQsXG4gICAgY3J1aXNlcjogMyxcbiAgICBzdWJtYXJpbmU6IDMsXG4gICAgZGVzdHJveWVyOiAyLFxufVxuXG5jb25zdCBzaGlwRmFjdG9yeSA9ICh0eXBlKSA9PiB7XG4gICAgLy8gUHJvcGVydGllc1xuICAgIGNvbnN0IGlkID0gdHlwZVxuICAgIGNvbnN0IGxlbmd0aCA9IHNoaXBMZW5ndGhzW3R5cGVdXG4gICAgbGV0IGRpcmVjdGlvbiA9ICdob3Jpem9udGFsJ1xuXG4gICAgY29uc3QgZ2V0RGlyZWN0aW9uID0gKCkgPT4gZGlyZWN0aW9uXG4gICAgY29uc3QgY2hhbmdlRGlyZWN0aW9uID0gKCkgPT4ge1xuICAgICAgICBkaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJ1xuICAgICAgICAgICAgPyAoZGlyZWN0aW9uID0gJ3ZlcnRpY2FsJylcbiAgICAgICAgICAgIDogKGRpcmVjdGlvbiA9ICdob3Jpem9udGFsJylcbiAgICB9XG5cbiAgICAvLyBIaXQgZnVuY3Rpb25cbiAgICBjb25zdCBoaXRzID0gQXJyYXkobGVuZ3RoKS5maWxsKG51bGwpXG4gICAgY29uc3QgaGl0ID0gKGkpID0+IChoaXRzW2ldID0gJ2hpdCcpXG4gICAgY29uc3QgZ2V0SGl0cyA9ICgpID0+IGhpdHNcblxuICAgIC8vIFN1bmsgZnVuY3Rpb25cbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiBoaXRzLmV2ZXJ5KChoKSA9PiBoID09PSAnaGl0JylcblxuICAgIHJldHVybiB7IGlkLCBsZW5ndGgsIGdldERpcmVjdGlvbiwgY2hhbmdlRGlyZWN0aW9uLCBoaXQsIGdldEhpdHMsIGlzU3VuayB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHNoaXBGYWN0b3J5XG4iLCJpbXBvcnQgeyBzaGlwcywgcmFuZG9tQ29vcmRpbmF0ZXMgfSBmcm9tICcuL2dhbWVib2FyZEZhY3RvcnknXG5pbXBvcnQgc2hpcEZhY3RvcnkgZnJvbSAnLi9zaGlwRmFjdG9yeSdcblxuY29uc3QgY3JlYXRlRmxlZXQgPSAodHlwZXMpID0+IHtcbiAgICBjb25zdCBmbGVldCA9IHt9XG4gICAgdHlwZXMuZm9yRWFjaCgodHlwZSkgPT4gKGZsZWV0W3R5cGVdID0gc2hpcEZhY3RvcnkodHlwZSkpKVxuICAgIHJldHVybiBmbGVldFxufVxuXG5jb25zdCBwbGF5ZXIgPSAodHlwZSkgPT4ge1xuICAgIGxldCBmbGVldCA9IGNyZWF0ZUZsZWV0KHNoaXBzKVxuXG4gICAgY29uc3QgZ2V0VHlwZSA9ICgpID0+IHR5cGVcbiAgICBjb25zdCBnZXRGbGVldCA9ICgpID0+IGZsZWV0XG5cbiAgICBjb25zdCBhdHRhY2sgPSAoeSwgeCwgY29tcHV0ZXJCb2FyZCkgPT4gY29tcHV0ZXJCb2FyZC5yZWNlaXZlQXR0YWNrKHksIHgpXG5cbiAgICBjb25zdCBhdXRvQXR0YWNrID0gKGh1bWFuQm9hcmQpID0+IHtcbiAgICAgICAgY29uc3QgW3ksIHhdID0gcmFuZG9tQ29vcmRpbmF0ZXMoKVxuICAgICAgICBjb25zdCBjZWxsID0gaHVtYW5Cb2FyZC5nZXRCb2FyZCgpW3ldW3hdXG4gICAgICAgIGlmIChjZWxsID09PSAnbWlzcycgfHwgY2VsbCA9PT0gJ2hpdCcpIHtcbiAgICAgICAgICAgIGF1dG9BdHRhY2soaHVtYW5Cb2FyZClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGh1bWFuQm9hcmQucmVjZWl2ZUF0dGFjayh5LCB4KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVzZXRGbGVldCA9ICgpID0+IChmbGVldCA9IGNyZWF0ZUZsZWV0KHNoaXBzKSlcblxuICAgIHJldHVybiB7IGdldFR5cGUsIGdldEZsZWV0LCBhdHRhY2ssIGF1dG9BdHRhY2ssIHJlc2V0RmxlZXQgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBwbGF5ZXJcbiIsImNvbnN0IHdpbm5lckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW5uZXItY29udGFpbmVyJylcbmNvbnN0IHdpbm5lckluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyLWluZm8nKVxuXG5jb25zdCBnYW1lYm9hcmRWaWV3ID0gKCgpID0+IHtcbiAgICBjb25zdCByZW5kZXJDZWxsID0gKHksIHgsIHN0YXR1cykgPT5cbiAgICAgICAgYDxkaXYgY2xhc3M9XCJncmlkLWNlbGwgY2VsbC0ke3l9LSR7eH0gJHtzdGF0dXN9XCIgZGF0YS15PScke3l9JyBkYXRhLXg9JyR7eH0nPjwvZGl2PmBcblxuICAgIGNvbnN0IGNsZWFyR3JpZCA9IChwYXJlbnQpID0+IHtcbiAgICAgICAgY29uc3QgZ3JpZCA9IHBhcmVudFxuICAgICAgICBncmlkLnRleHRDb250ZW50ID0gJydcbiAgICB9XG5cbiAgICBjb25zdCByZW5kZXJHcmlkID0gKHBhcmVudCwgZ2FtZWJvYXJkLCB0eXBlKSA9PiB7XG4gICAgICAgIGNsZWFyR3JpZChwYXJlbnQpXG4gICAgICAgIGNvbnN0IGJvYXJkID0gZ2FtZWJvYXJkLmdldEJvYXJkKClcbiAgICAgICAgY29uc3QgeyBsZW5ndGggfSA9IGJvYXJkXG4gICAgICAgIGxldCBncmlkID0gJydcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGxldCBzdGF0dXMgPSBib2FyZFtpXVtqXVxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gJydcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cy5zaGlwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qICAgaWYgKHR5cGUgPT09ICdodW1hbicpIHsgKi9cbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gc3RhdHVzLnNoaXAuaWRcbiAgICAgICAgICAgICAgICAgICAgLyogICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gJydcbiAgICAgICAgICAgICAgICAgICAgfSAqL1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBncmlkICs9IHJlbmRlckNlbGwoaSwgaiwgc3RhdHVzKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHBhcmVudC5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCBncmlkKVxuICAgIH1cblxuICAgIGNvbnN0IHJlbmRlcldpbm5lciA9ICh3aW5uZXIpID0+IHtcbiAgICAgICAgd2lubmVyQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpXG4gICAgICAgIHdpbm5lckluZm8udGV4dENvbnRlbnQgPSB3aW5uZXJcbiAgICB9XG5cbiAgICByZXR1cm4geyByZW5kZXJHcmlkLCByZW5kZXJXaW5uZXIgfVxufSkoKVxuZXhwb3J0IGRlZmF1bHQgZ2FtZWJvYXJkVmlld1xuIiwiaW1wb3J0IHBsYXllciBmcm9tICcuL3BsYXllckZhY3RvcnknXG5pbXBvcnQgZ2FtZWJvYXJkRmFjdG9yeSBmcm9tICcuL2dhbWVib2FyZEZhY3RvcnknXG5pbXBvcnQgc2hpcEZhY3RvcnkgZnJvbSAnLi9zaGlwRmFjdG9yeSdcbmltcG9ydCBnYW1lYm9hcmRWaWV3IGZyb20gJy4vZG9tJ1xuXG5jb25zdCBwMUdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZC1wMScpXG5jb25zdCBwMkdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ3JpZC1wMicpXG5cbmNvbnN0IGdhbWUgPSAoKSA9PiB7XG4gICAgLy8gY3JlYXRlIHBsYXllcnNcbiAgICBjb25zdCBwMSA9IHBsYXllcignaHVtYW4nKVxuICAgIGNvbnN0IHAyID0gcGxheWVyKCdjb21wdXRlcicpXG5cbiAgICAvLyBjcmVhdGUgYm9hcmRzXG4gICAgY29uc3QgcDFCb2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKVxuICAgIGNvbnN0IHAyQm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KClcblxuICAgIC8vIHByZWRldGVybWluZWQgY29vcmRpbmF0ZXNcbiAgICBjb25zdCBjYXJyaWVyID0gc2hpcEZhY3RvcnkoJ2NhcnJpZXInKVxuICAgIHAxQm9hcmQucGxhY2VTaGlwKGNhcnJpZXIsIDAsIDApXG4gICAgY29uc3QgYmF0dGxlc2hpcCA9IHNoaXBGYWN0b3J5KCdiYXR0bGVzaGlwJylcbiAgICBwMkJvYXJkLnBsYWNlU2hpcChiYXR0bGVzaGlwLCAwLCAwKVxuXG4gICAgY29uc3QgcmVuZGVyR3JpZHMgPSAoKSA9PiB7XG4gICAgICAgIGdhbWVib2FyZFZpZXcucmVuZGVyR3JpZChwMUdyaWQsIHAxQm9hcmQsIHAxLmdldFR5cGUoKSlcbiAgICAgICAgZ2FtZWJvYXJkVmlldy5yZW5kZXJHcmlkKHAyR3JpZCwgcDJCb2FyZCwgcDIuZ2V0VHlwZSgpKVxuICAgIH1cblxuICAgIGNvbnN0IGF0dGFjayA9IChlKSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBlLnRhcmdldFxuICAgICAgICBpZiAoY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ2dyaWQtY2VsbCcpKSB7XG4gICAgICAgICAgICBjb25zdCB7IHkgfSA9IGNlbGwuZGF0YXNldFxuICAgICAgICAgICAgY29uc3QgeyB4IH0gPSBjZWxsLmRhdGFzZXRcblxuICAgICAgICAgICAgY29uc3QgYm9hcmRDZWxsID0gcDJCb2FyZC5nZXRCb2FyZCgpW3ldW3hdXG4gICAgICAgICAgICBpZiAoYm9hcmRDZWxsICE9PSAnbWlzcycgJiYgYm9hcmRDZWxsICE9PSAnaGl0Jykge1xuICAgICAgICAgICAgICAgIHAxLmF0dGFjayh5LCB4LCBwMkJvYXJkKVxuICAgICAgICAgICAgICAgIHAyLmF1dG9BdHRhY2socDFCb2FyZClcblxuICAgICAgICAgICAgICAgIHJlbmRlckdyaWRzKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwMUJvYXJkLmFyZUFsbFNoaXBzU3VuaygpIHx8IHAyQm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgd2lubmVyID0gJydcbiAgICAgICAgICAgICAgICBpZiAocDFCb2FyZC5hcmVBbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5uZXIgPSAnQ29tcHV0ZXIgd2lucyEnXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwMkJvYXJkLmFyZUFsbFNoaXBzU3VuaygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbm5lciA9ICdIdW1hbiB3aW5zISdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcDJHcmlkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXR0YWNrKVxuICAgICAgICAgICAgICAgIGdhbWVib2FyZFZpZXcucmVuZGVyV2lubmVyKHdpbm5lcilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGFkZEF0dGFja0V2ZW50TGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgICAgIHAyR3JpZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGF0dGFjaylcbiAgICB9XG5cbiAgICByZXR1cm4geyByZW5kZXJHcmlkcywgYWRkQXR0YWNrRXZlbnRMaXN0ZW5lciB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWVcbiIsImltcG9ydCBnYW1lIGZyb20gJy4vZ2FtZSdcblxuZ2FtZSgpLnJlbmRlckdyaWRzKClcblxuZ2FtZSgpLmFkZEF0dGFja0V2ZW50TGlzdGVuZXIoKVxuIl0sIm5hbWVzIjpbInNoaXBzIiwicmFuZG9tIiwic2l6ZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbUNvb3JkaW5hdGVzIiwiYm9hcmQiLCJBcnJheSIsImZpbGwiLCJtYXAiLCJwbGFjZWRTaGlwcyIsImFkanVzdENvb3JkaW5hdGVzIiwieTAiLCJ4MCIsImkiLCJkaXJlY3Rpb24iLCJ4IiwieSIsInBsYWNlU2hpcCIsInNoaXAiLCJnZXREaXJlY3Rpb24iLCJ2YWxpZCIsImxlbmd0aCIsImNlbGxzIiwicHVzaCIsImV2ZXJ5IiwiY2VsbCIsImNoZWNrVmFsaWQiLCJpbmRleCIsImF1dG9QbGFjZSIsImNoYW5nZURpcmVjdGlvbiIsImdldEJvYXJkIiwiYXJlQWxsU2hpcHNQbGFjZWQiLCJyZWNlaXZlQXR0YWNrIiwiaGl0IiwiYXJlQWxsU2hpcHNTdW5rIiwiaXNTdW5rIiwicmVzZXQiLCJhdXRvUGxhY2VGbGVldCIsImZsZWV0Iiwic2hpcExlbmd0aHMiLCJjYXJyaWVyIiwiYmF0dGxlc2hpcCIsImNydWlzZXIiLCJzdWJtYXJpbmUiLCJkZXN0cm95ZXIiLCJ0eXBlIiwiaWQiLCJoaXRzIiwiZ2V0SGl0cyIsImgiLCJjcmVhdGVGbGVldCIsInR5cGVzIiwiZm9yRWFjaCIsImF1dG9BdHRhY2siLCJodW1hbkJvYXJkIiwiZ2V0VHlwZSIsImdldEZsZWV0IiwiYXR0YWNrIiwiY29tcHV0ZXJCb2FyZCIsInJlc2V0RmxlZXQiLCJ3aW5uZXJDb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ3aW5uZXJJbmZvIiwicmVuZGVyQ2VsbCIsInN0YXR1cyIsInJlbmRlckdyaWQiLCJwYXJlbnQiLCJnYW1lYm9hcmQiLCJ0ZXh0Q29udGVudCIsImNsZWFyR3JpZCIsImdyaWQiLCJqIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwicmVuZGVyV2lubmVyIiwid2lubmVyIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwicDFHcmlkIiwicDJHcmlkIiwicDEiLCJwMiIsInAxQm9hcmQiLCJwMkJvYXJkIiwicmVuZGVyR3JpZHMiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJkYXRhc2V0IiwiYm9hcmRDZWxsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEF0dGFja0V2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIl0sInNvdXJjZVJvb3QiOiIifQ==